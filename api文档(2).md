# iCalligraphy API å®Œæ•´æ–‡æ¡£ v1.0

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-12-03  
**Base URL**: `http://localhost:5000`  
**è®¤è¯æ–¹å¼**: JWT Bearer Token

---

## ğŸ“‹ ç›®å½•

1. [ç»Ÿä¸€å“åº”æ ¼å¼è§„èŒƒ](#ç»Ÿä¸€å“åº”æ ¼å¼è§„èŒƒ)
2. [è®¤è¯ç›¸å…³ API](#1-è®¤è¯ç›¸å…³-api)
3. [ç”¨æˆ·ç›¸å…³ API](#2-ç”¨æˆ·ç›¸å…³-api)
4. [ä½œå“ç›¸å…³ API](#3-ä½œå“ç›¸å…³-api)
5. [å•å­—/å­—é›†ç›¸å…³ API](#4-å•å­—å­—é›†ç›¸å…³-api)
6. [è¯»å¸–ç›¸å…³ API](#5-è¯»å¸–ç›¸å…³-api)
7. [ç¤¾åŒº/å¸–å­ç›¸å…³ API](#6-ç¤¾åŒºå¸–å­ç›¸å…³-api)
8. [æ”¶è—ç›¸å…³ API](#7-æ”¶è—ç›¸å…³-api)
9. [è¯„è®ºç›¸å…³ API](#8-è¯„è®ºç›¸å…³-api)
10. [æ¶ˆæ¯é€šçŸ¥ API](#9-æ¶ˆæ¯é€šçŸ¥-api)
11. [æ¯æ—¥æ‰“å¡ API](#10-æ¯æ—¥æ‰“å¡-api)
12. [å®¡æ ¸ä¸­å¿ƒ API](#11-å®¡æ ¸ä¸­å¿ƒ-api)
13. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
14. [é”™è¯¯ç è¯´æ˜](#é”™è¯¯ç è¯´æ˜)

---

## ç»Ÿä¸€å“åº”æ ¼å¼è§„èŒƒ

### æˆåŠŸå“åº”æ ¼å¼

```json
{
  "code": 200,              // HTTPçŠ¶æ€ç 
  "message": "æ“ä½œæˆåŠŸ",     // æ“ä½œç»“æœæè¿°
  "data": {                 // å®é™…è¿”å›çš„æ•°æ®
    // å…·ä½“çš„è¿”å›æ•°æ®
  },
  "timestamp": "2025-12-03T10:00:00+08:00"  // æœåŠ¡å™¨å“åº”æ—¶é—´æˆ³ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
}
```

### åˆ†é¡µæ•°æ®å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [],          // å½“å‰é¡µçš„æ•°æ®åˆ—è¡¨
    "pagination": {
      "current_page": 1,  // å½“å‰é¡µç 
      "per_page": 12,     // æ¯é¡µæ˜¾ç¤ºæ•°é‡
      "total": 100,       // æ€»è®°å½•æ•°
      "total_pages": 9,   // æ€»é¡µæ•°
      "has_next": true,   // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
      "has_prev": false   // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "code": 400,                    // HTTPé”™è¯¯çŠ¶æ€ç 
  "message": "é”™è¯¯æè¿°ä¿¡æ¯",       // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
  "error": {
    "type": "ValidationError",    // é”™è¯¯ç±»å‹
    "details": {                  // è¯¦ç»†é”™è¯¯ä¿¡æ¯
      "field": "username",        // å‡ºé”™çš„å­—æ®µå
      "reason": "ç”¨æˆ·åå·²å­˜åœ¨"    // é”™è¯¯åŸå› 
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

### HTTP çŠ¶æ€ç å®šä¹‰

| çŠ¶æ€ç  | è¯´æ˜    | ä½¿ç”¨åœºæ™¯        |
| --- | ----- | ----------- |
| 200 | æˆåŠŸ    | è¯·æ±‚æˆåŠŸå¤„ç†      |
| 201 | åˆ›å»ºæˆåŠŸ  | èµ„æºåˆ›å»ºæˆåŠŸ      |
| 204 | æ— å†…å®¹   | åˆ é™¤æˆåŠŸï¼Œæ— è¿”å›å†…å®¹  |
| 400 | è¯·æ±‚é”™è¯¯  | å‚æ•°é”™è¯¯ã€éªŒè¯å¤±è´¥   |
| 401 | æœªè®¤è¯   | Tokenæ— æ•ˆæˆ–è¿‡æœŸ  |
| 403 | æ— æƒé™   | æ²¡æœ‰æ“ä½œæƒé™      |
| 404 | ä¸å­˜åœ¨   | èµ„æºä¸å­˜åœ¨       |
| 409 | å†²çª    | èµ„æºå†²çªï¼ˆå¦‚é‡å¤æ”¶è—ï¼‰ |
| 422 | æ— æ³•å¤„ç†  | è¯·æ±‚æ ¼å¼æ­£ç¡®ä½†è¯­ä¹‰é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯     |
| 502 | ç½‘å…³é”™è¯¯  | å¤–éƒ¨APIè°ƒç”¨å¤±è´¥   |
| 503 | æœåŠ¡ä¸å¯ç”¨ | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨     |

---

## 1. è®¤è¯ç›¸å…³ API

### 1.1 ç”¨æˆ·æ³¨å†Œ

**æ¥å£**: `POST /api/auth/register`  
**æè¿°**: åˆ›å»ºæ–°ç”¨æˆ·è´¦å·  
**è®¤è¯**: æ— éœ€è®¤è¯

**è¯·æ±‚ä½“**:

```json
{
  "username": "testuser",
  // ã€å¿…å¡«ã€‘ç”¨æˆ·å
  // è§„åˆ™ï¼š3-20ä¸ªå­—ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
  // å”¯ä¸€æ€§ï¼šå¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½ä¸å·²æœ‰ç”¨æˆ·é‡å¤
  // ç¤ºä¾‹ï¼š"zhang_san123"

  "email": "test@example.com",
  // ã€å¿…å¡«ã€‘é‚®ç®±åœ°å€
  // è§„åˆ™ï¼šå¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼
  // å”¯ä¸€æ€§ï¼šå¿…é¡»å”¯ä¸€
  // ç”¨é€”ï¼šç”¨äºç™»å½•ã€æ‰¾å›å¯†ç ã€æ¥æ”¶é€šçŸ¥
  // ç¤ºä¾‹ï¼š"user@gmail.com"

  "password": "password123",
  // ã€å¿…å¡«ã€‘å¯†ç 
  // è§„åˆ™ï¼šè‡³å°‘6ä¸ªå­—ç¬¦ï¼Œå»ºè®®åŒ…å«å­—æ¯å’Œæ•°å­—
  // å®‰å…¨æ€§ï¼šä¼šè¿›è¡Œå“ˆå¸ŒåŠ å¯†å­˜å‚¨
  // ç¤ºä¾‹ï¼š"abc123456"

  "phone": "13800138000",
  // ã€å¯é€‰ã€‘æ‰‹æœºå·ç 
  // è§„åˆ™ï¼š11ä½æ•°å­—
  // å”¯ä¸€æ€§ï¼šå¿…é¡»å”¯ä¸€
  // ç”¨é€”ï¼šç”¨äºè´¦å·æ‰¾å›å’Œç»‘å®š
  // ç¤ºä¾‹ï¼š"13912345678"

  "gender": "male",
  // ã€å¯é€‰ã€‘æ€§åˆ«
  // å¯é€‰å€¼ï¼šmaleï¼ˆç”·ï¼‰/ femaleï¼ˆå¥³ï¼‰/ otherï¼ˆå…¶ä»–ï¼‰
  // ç”¨é€”ï¼šç”¨äºç”¨æˆ·ç”»åƒ

  "birthdate": "1990-01-01",
  // ã€å¯é€‰ã€‘å‡ºç”Ÿæ—¥æœŸ
  // æ ¼å¼ï¼šYYYY-MM-DD
  // è§„åˆ™ï¼šä¸èƒ½æ˜¯æœªæ¥æ—¥æœŸ
  // ç”¨é€”ï¼šç”¨äºç”¨æˆ·ç”»åƒ

  "bio": "çƒ­çˆ±ä¹¦æ³•çš„åˆå­¦è€…"
  // ã€å¯é€‰ã€‘ä¸ªäººç®€ä»‹
  // è§„åˆ™ï¼šæœ€å¤š200å­—
  // ç”¨é€”ï¼šå±•ç¤ºåœ¨ä¸ªäººä¸»é¡µ
}
```

**å“åº”**:

```json
{
  "code": 201,
  // 201è¡¨ç¤ºèµ„æºåˆ›å»ºæˆåŠŸ

  "message": "æ³¨å†ŒæˆåŠŸ",

  "data": {
    "user": {
      "id": 1,
      // ç”¨æˆ·IDï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œå…¨å±€å”¯ä¸€

      "username": "testuser",
      "email": "test@example.com",
      "phone": "13800138000",

      "avatar": "default_avatar.png",
      // é»˜è®¤å¤´åƒæ–‡ä»¶åï¼Œå¯é€šè¿‡ä¸Šä¼ å¤´åƒæ¥å£ä¿®æ”¹

      "bio": "çƒ­çˆ±ä¹¦æ³•çš„åˆå­¦è€…",
      "gender": "male",
      "birthdate": "1990-01-01",

      "is_admin": false,
      // æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼Œæ™®é€šç”¨æˆ·æ³¨å†Œé»˜è®¤false

      "created_at": "2025-12-03T10:00:00",
      // è´¦å·åˆ›å»ºæ—¶é—´ï¼ŒISO 8601æ ¼å¼

      "works_count": 0,
      // å·²ä¸Šä¼ ä½œå“æ•°é‡ï¼ˆä»…ç»Ÿè®¡å®¡æ ¸é€šè¿‡çš„ï¼‰

      "collections_count": 0,
      // æ”¶è—ä½œå“æ•°é‡

      "posts_count": 0,
      // å‘å¸–æ•°é‡

      "followers_count": 0,
      // ç²‰ä¸æ•°é‡

      "following_count": 0,
      // å…³æ³¨ç”¨æˆ·æ•°é‡

      "likes_received": 0
      // æ”¶åˆ°çš„ç‚¹èµæ€»æ•°ï¼ˆæ‰€æœ‰ä½œå“çš„ç‚¹èµæ•°ä¹‹å’Œï¼‰
    },

    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    // è®¿é—®ä»¤ç‰Œï¼ˆJWTï¼‰
    // æœ‰æ•ˆæœŸï¼š24å°æ—¶
    // ç”¨é€”ï¼šç”¨äºåç»­APIè¯·æ±‚çš„èº«ä»½è®¤è¯
    // ä½¿ç”¨æ–¹å¼ï¼šåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  Authorization: Bearer <access_token>

    "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
    // åˆ·æ–°ä»¤ç‰Œï¼ˆJWTï¼‰
    // æœ‰æ•ˆæœŸï¼š30å¤©
    // ç”¨é€”ï¼šå½“access_tokenè¿‡æœŸæ—¶ï¼Œç”¨äºè·å–æ–°çš„access_token
    // ä½¿ç”¨æ–¹å¼ï¼šè°ƒç”¨ /api/auth/refresh æ¥å£
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**:

```json
{
  "code": 409,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "error": {
    "type": "DuplicateError",
    "details": {
      "field": "username",
      "reason": "ç”¨æˆ·å 'testuser' å·²è¢«ä½¿ç”¨"
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 1.2 ç”¨æˆ·ç™»å½•

**æ¥å£**: `POST /api/auth/login`  
**æè¿°**: ç”¨æˆ·è´¦å·ç™»å½•ï¼Œè·å–è®¿é—®ä»¤ç‰Œ  
**è®¤è¯**: æ— éœ€è®¤è¯

**è¯·æ±‚ä½“**:

```json
{
  "username": "testuser",
  // ã€å¿…å¡«ã€‘ç”¨æˆ·åæˆ–é‚®ç®±
  // æ”¯æŒï¼šå¯ä»¥ä½¿ç”¨æ³¨å†Œæ—¶çš„ç”¨æˆ·åæˆ–é‚®ç®±ç™»å½•
  // ç¤ºä¾‹ï¼š
  //   - ç”¨æˆ·åï¼š"testuser"
  //   - é‚®ç®±ï¼š"test@example.com"

  "password": "password123"
  // ã€å¿…å¡«ã€‘è´¦å·å¯†ç 
  // å¿…é¡»ä¸æ³¨å†Œæ—¶è®¾ç½®çš„å¯†ç ä¸€è‡´
  // åŒºåˆ†å¤§å°å†™
}
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "user": {
      // ç”¨æˆ·å®Œæ•´ä¿¡æ¯ï¼Œç»“æ„åŒæ³¨å†Œå“åº”
      "id": 1,
      "username": "testuser",
      // ...  å…¶ä»–ç”¨æˆ·ä¿¡æ¯
    },

    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    // è®¿é—®ä»¤ç‰Œï¼Œåç»­è¯·æ±‚éœ€æºå¸¦æ­¤token

    "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
    // åˆ·æ–°ä»¤ç‰Œ
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**é”™è¯¯å“åº”**:

```json
{
  "code": 401,
  // 401è¡¨ç¤ºè®¤è¯å¤±è´¥

  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "error": {
    "type": "AuthenticationError",
    // è®¤è¯é”™è¯¯ç±»å‹

    "details": null
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 1.3 åˆ·æ–°Token

**æ¥å£**: `POST /api/auth/refresh`  
**æè¿°**: ä½¿ç”¨refresh_tokenè·å–æ–°çš„access_token  
**è®¤è¯**: éœ€è¦ Refresh Token

**è¯·æ±‚å¤´**:

```
Authorization: Bearer <refresh_token>
// æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯refresh_tokenï¼Œä¸æ˜¯access_token
// refresh_tokenåœ¨ç™»å½•æˆ–æ³¨å†Œæ—¶è·å¾—
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "Tokenåˆ·æ–°æˆåŠŸ",
  "data": {
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
    // æ–°çš„è®¿é—®ä»¤ç‰Œ
    // æœ‰æ•ˆæœŸï¼š24å°æ—¶
    // ä½¿ç”¨åœºæ™¯ï¼šå½“åŸaccess_tokenè¿‡æœŸæ—¶ï¼Œæ— éœ€é‡æ–°ç™»å½•å³å¯è·å–æ–°token
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 1.4 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**æ¥å£**: `GET /api/auth/me`  
**æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚å¤´**:

```
Authorization: Bearer <access_token>
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example. com",
      "phone": "13800138000",

      "avatar": "avatars/user_1.jpg",
      // å¤´åƒURLè·¯å¾„ï¼Œå®Œæ•´URLéœ€è¦æ‹¼æ¥åŸŸå
      // è®¿é—®æ–¹å¼ï¼šhttp://åŸŸå/uploads/avatars/user_1. jpg

      "bio": "çƒ­çˆ±ä¹¦æ³•",
      "gender": "male",
      "birthdate": "1990-01-01",
      "is_admin": false,
      "created_at": "2025-12-03T10:00:00",

      "works_count": 10,
      // å®æ—¶ç»Ÿè®¡ï¼Œä»…åŒ…å«å®¡æ ¸é€šè¿‡çš„ä½œå“

      "collections_count": 20,
      "posts_count": 15,
      "followers_count": 100,
      "following_count": 50,

      "likes_received": 200
      // æ‰€æœ‰å·²å®¡æ ¸é€šè¿‡ä½œå“æ”¶åˆ°çš„ç‚¹èµæ€»æ•°
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 1.5 ç”¨æˆ·ç™»å‡º

**æ¥å£**: `POST /api/auth/logout`  
**æè¿°**: ç™»å‡ºå½“å‰è´¦å·ï¼Œä½¿tokenå¤±æ•ˆ  
**è®¤è¯**: éœ€è¦ Access Token

**å“åº”**:

```json
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ",
  "data": null,
  // ç™»å‡ºæ“ä½œæ— éœ€è¿”å›æ•°æ®

  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**æ³¨æ„äº‹é¡¹**:

- å‰ç«¯åº”åœ¨æ”¶åˆ°ç™»å‡ºå“åº”åæ¸…é™¤æœ¬åœ°å­˜å‚¨çš„token
- åç«¯å¯é€‰å®ç°tokené»‘åå•æœºåˆ¶ï¼Œå°†å·²ç™»å‡ºçš„tokenåŠ å…¥é»‘åå•

---

## 2. ç”¨æˆ·ç›¸å…³ API

### 2.1 è·å–ç”¨æˆ·ä¿¡æ¯

**æ¥å£**: `GET /api/users/{user_id}`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„å…¬å¼€ä¿¡æ¯  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `user_id`:
  - ã€å¿…å¡«ã€‘ç”¨æˆ·ID
  - ç±»å‹ï¼šæ•´æ•°ï¼ˆintegerï¼‰
  - ç¤ºä¾‹ï¼š`/api/users/1`

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",

      "email": "t***@example.com",
      // æ³¨æ„ï¼šæŸ¥çœ‹ä»–äººä¿¡æ¯æ—¶ï¼Œé‚®ç®±è„±æ•æ˜¾ç¤º
      // ä»…æŸ¥çœ‹è‡ªå·±ä¿¡æ¯æ—¶æ˜¾ç¤ºå®Œæ•´é‚®ç®±

      "phone": "138****8000",
      // æ³¨æ„ï¼šæŸ¥çœ‹ä»–äººä¿¡æ¯æ—¶ï¼Œæ‰‹æœºå·è„±æ•æ˜¾ç¤º
      // æ ¼å¼ï¼šå‰3ä½+****+å4ä½

      "avatar": "avatars/user_1.jpg",
      "bio": "çƒ­çˆ±ä¹¦æ³•",
      "gender": "male",
      "birthdate": "1990-01-01",
      "is_admin": false,
      "created_at": "2025-12-03T10:00:00",

      "works_count": 10,
      // ä»…ç»Ÿè®¡å·²å®¡æ ¸é€šè¿‡çš„å…¬å¼€ä½œå“

      "collections_count": 20,
      "posts_count": 15,
      "followers_count": 100,
      "following_count": 50,
      "likes_received": 200
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.2 è·å–ç”¨æˆ·ä½œå“åˆ—è¡¨

**æ¥å£**: `GET /api/users/{user_id}/works`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·ä¸Šä¼ çš„ä½œå“åˆ—è¡¨ï¼ˆä»…æ˜¾ç¤ºå·²å®¡æ ¸é€šè¿‡çš„ï¼‰  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `user_id`: ã€å¿…å¡«ã€‘ç”¨æˆ·ID

**æŸ¥è¯¢å‚æ•°**:

- `page`:
  
  - ã€å¯é€‰ã€‘é¡µç 
  - ç±»å‹ï¼šæ•´æ•°
  - é»˜è®¤å€¼ï¼š1
  - æœ€å°å€¼ï¼š1
  - ç¤ºä¾‹ï¼š`? page=2`

- `per_page`:
  
  - ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡
  - ç±»å‹ï¼šæ•´æ•°
  - é»˜è®¤å€¼ï¼š12
  - èŒƒå›´ï¼š1-50
  - ç¤ºä¾‹ï¼š`?per_page=20`

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /api/users/1/works?page=1&per_page=12
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "å…°äº­åº",

        "description": "å¤©ä¸‹ç¬¬ä¸€è¡Œä¹¦",
        // ä½œå“æè¿°/ä»‹ç»ï¼Œå¯ä»¥ä¸ºç©º

        "image_url": "/uploads/works/lantingxu.jpg",
        // ä½œå“å›¾ç‰‡ç›¸å¯¹è·¯å¾„
        // å®Œæ•´URLæ‹¼æ¥ï¼šhttp://åŸŸå + image_url

        "style": "è¡Œä¹¦",
        // ä¹¦æ³•é£æ ¼ï¼šæ¥·ä¹¦/è¡Œä¹¦/è‰ä¹¦/éš¶ä¹¦/ç¯†ä¹¦ç­‰

        "dynasty": "ä¸œæ™‹",
        // æœä»£ï¼šå”/å®‹/å…ƒ/æ˜/æ¸…/ä¸œæ™‹ç­‰

        "author_name": "ç‹ç¾²ä¹‹",
        // ä¹¦æ³•ä½œå“çš„åŸä½œè€…ï¼ˆéä¸Šä¼ è€…ï¼‰
        // æ³¨æ„ï¼šè¿™æ˜¯å†å²äººç‰©ï¼Œä¸æ˜¯å¹³å°ç”¨æˆ·

        "character_count": 324,
        // è¯†åˆ«å‡ºçš„å•å­—æ•°é‡
        // é€šè¿‡OCRæˆ–æ‰‹åŠ¨æ ‡æ³¨è·å¾—

        "views": 1000,
        // æµè§ˆæ¬¡æ•°
        // è®¡æ•°è§„åˆ™ï¼šæ¯æ¬¡æŸ¥çœ‹è¯¦æƒ…é¡µ+1

        "likes_count": 100,
        // ç‚¹èµæ•°

        "comments_count": 50,
        // è¯„è®ºæ•°ï¼ˆåŒ…å«å›å¤ï¼‰

        "collections_count": 80,
        // æ”¶è—æ•°

        "status": "approved",
        // å®¡æ ¸çŠ¶æ€
        // å¯é€‰å€¼ï¼š
        //   - pending: å¾…å®¡æ ¸
        //   - approved: å·²é€šè¿‡
        //   - rejected: å·²æ‹’ç»

        "created_at": "2025-12-03T10:00:00"
        // ä¸Šä¼ æ—¶é—´
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 12,
      "total": 100,
      "total_pages": 9,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2. 3 æ›´æ–°ç”¨æˆ·èµ„æ–™

**æ¥å£**: `PUT /api/users/profile`  
**æè¿°**: æ›´æ–°å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªäººèµ„æ–™  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**:

```json
{
  "email": "newemail@example.com",
  // ã€å¯é€‰ã€‘æ–°é‚®ç®±åœ°å€
  // è§„åˆ™ï¼šå¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼
  // å”¯ä¸€æ€§ï¼šä¸èƒ½ä¸å…¶ä»–ç”¨æˆ·çš„é‚®ç®±é‡å¤
  // éªŒè¯ï¼šå»ºè®®å‘é€éªŒè¯é‚®ä»¶ç¡®è®¤

  "bio": "ä¹¦æ³•çˆ±å¥½è€…ï¼Œä¸“æ³¨ä¸´å¸–åå¹´",
  // ã€å¯é€‰ã€‘ä¸ªäººç®€ä»‹
  // è§„åˆ™ï¼šæœ€å¤š200å­—
  // ç”¨é€”ï¼šå±•ç¤ºåœ¨ä¸ªäººä¸»é¡µå’Œè¯„è®ºåŒº

  "phone": "13900139000",
  // ã€å¯é€‰ã€‘æ–°æ‰‹æœºå·
  // è§„åˆ™ï¼š11ä½æ•°å­—
  // å”¯ä¸€æ€§ï¼šä¸èƒ½ä¸å…¶ä»–ç”¨æˆ·çš„æ‰‹æœºå·é‡å¤

  "gender": "male",
  // ã€å¯é€‰ã€‘æ€§åˆ«
  // å¯é€‰å€¼ï¼šmale/female/other

  "birthdate": "1990-01-01"
  // ã€å¯é€‰ã€‘å‡ºç”Ÿæ—¥æœŸ
  // æ ¼å¼ï¼šYYYY-MM-DD
  // è§„åˆ™ï¼šä¸èƒ½æ˜¯æœªæ¥æ—¥æœŸ
}
```

**æ³¨æ„**:

- **ä¸èƒ½ä¿®æ”¹çš„å­—æ®µ**ï¼šusernameï¼ˆç”¨æˆ·åï¼‰ã€created_atï¼ˆåˆ›å»ºæ—¶é—´ï¼‰
- æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œåªä¼ éœ€è¦ä¿®æ”¹çš„å­—æ®µ
- ç©ºå­—ç¬¦ä¸²ä¼šæ¸…ç©ºè¯¥å­—æ®µå†…å®¹

**å“åº”**:

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "user": {
      // æ›´æ–°åçš„å®Œæ•´ç”¨æˆ·ä¿¡æ¯
      "id": 1,
      "username": "testuser",
      // æ³¨æ„ï¼šç”¨æˆ·åä¸èƒ½ä¿®æ”¹

      "email": "newemail@example.com",
      // å·²æ›´æ–°

      "phone": "13900139000",
      // å·²æ›´æ–°

      "bio": "ä¹¦æ³•çˆ±å¥½è€…ï¼Œä¸“æ³¨ä¸´å¸–åå¹´",
      // å·²æ›´æ–°

      "gender": "male",
      "birthdate": "1990-01-01",
      "avatar": "avatars/user_1.jpg",
      "is_admin": false,
      "created_at": "2025-12-03T10:00:00",
      "works_count": 10,
      "collections_count": 20,
      "posts_count": 15,
      "followers_count": 100,
      "following_count": 50,
      "likes_received": 200
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.4 ä¿®æ”¹å¯†ç 

**æ¥å£**: `PUT /api/users/password`  
**æè¿°**: ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç   
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**:

```json
{
  "old_password": "oldpassword123",
  // ã€å¿…å¡«ã€‘å½“å‰å¯†ç 
  // ç”¨é€”ï¼šéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé˜²æ­¢ä»–äººä¿®æ”¹
  // è§„åˆ™ï¼šå¿…é¡»ä¸æ•°æ®åº“ä¸­å­˜å‚¨çš„å¯†ç åŒ¹é…

  "new_password": "newpassword123"
  // ã€å¿…å¡«ã€‘æ–°å¯†ç 
  // è§„åˆ™ï¼šè‡³å°‘6ä¸ªå­—ç¬¦
  // å»ºè®®ï¼šåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
  // é™åˆ¶ï¼šä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
}
```

**å®‰å…¨å»ºè®®**:

1. æ–°å¯†ç åº”ä¸æ—§å¯†ç ä¸åŒ
2. å¯†ç é•¿åº¦å»ºè®®8ä½ä»¥ä¸Š
3. åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
4. ä¸è¦ä½¿ç”¨å¸¸è§å¯†ç ï¼ˆå¦‚123456ã€passwordç­‰ï¼‰

**å“åº”**:

```json
{
  "code": 200,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ",
  "data": null,
  // å¯†ç ä¿®æ”¹æˆåŠŸåæ— éœ€è¿”å›æ•°æ®

  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**æ³¨æ„äº‹é¡¹**:

- ä¿®æ”¹å¯†ç åï¼Œå»ºè®®æ¸…é™¤æ‰€æœ‰å·²ç™»å½•çš„session
- å‰ç«¯åº”æç¤ºç”¨æˆ·é‡æ–°ç™»å½•
- å¯é€‰ï¼šå‘é€é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·å¯†ç å·²ä¿®æ”¹

**é”™è¯¯å“åº”**:

```json
{
  "code": 400,
  "message": "åŸå¯†ç é”™è¯¯",
  "error": {
    "type": "ValidationError",
    "details": {
      "field": "old_password",
      "reason": "åŸå¯†ç ä¸æ­£ç¡®"
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.5 ä¸Šä¼ å¤´åƒ

**æ¥å£**: `POST /api/users/avatar`  
**æè¿°**: ä¸Šä¼ æˆ–æ›´æ–°ç”¨æˆ·å¤´åƒ  
**è®¤è¯**: éœ€è¦ Access Token  
**Content-Type**: `multipart/form-data`

**è¯·æ±‚ä½“ï¼ˆè¡¨å•æ•°æ®ï¼‰**:

- `avatar`:
  - ã€å¿…å¡«ã€‘å›¾ç‰‡æ–‡ä»¶
  - æ”¯æŒæ ¼å¼ï¼šjpgã€pngã€jpeg
  - æ–‡ä»¶å¤§å°ï¼šæœ€å¤§10MB
  - å»ºè®®å°ºå¯¸ï¼š200x200åƒç´ ä»¥ä¸Š
  - å»ºè®®æ¯”ä¾‹ï¼šæ­£æ–¹å½¢ï¼ˆ1:1ï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼ˆä½¿ç”¨curlï¼‰**:

```bash
curl -X POST http://localhost:5000/api/users/avatar \
  -H "Authorization: Bearer <access_token>" \
  -F "avatar=@/path/to/avatar.jpg"
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "data": {
    "avatar": "avatars/user_1_20251203. jpg"
    // æ–°å¤´åƒçš„URLè·¯å¾„
    // æ–‡ä»¶å‘½åè§„åˆ™ï¼šuser_{ç”¨æˆ·ID}_{æ—¶é—´æˆ³}.{æ‰©å±•å}
    // è¯´æ˜ï¼šæ—§å¤´åƒæ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ï¼ˆé»˜è®¤å¤´åƒé™¤å¤–ï¼‰
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**å¤„ç†æµç¨‹**:

1. éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
2. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆé˜²æ­¢é‡åï¼‰
3. ä¿å­˜æ–‡ä»¶åˆ°æœåŠ¡å™¨
4. åˆ é™¤æ—§å¤´åƒæ–‡ä»¶ï¼ˆå¦‚æœä¸æ˜¯é»˜è®¤å¤´åƒï¼‰
5. æ›´æ–°æ•°æ®åº“ä¸­çš„avatarå­—æ®µ
6. è¿”å›æ–°å¤´åƒè·¯å¾„

---

### 2.6 ç»‘å®šæ‰‹æœºå·

**æ¥å£**: `POST /api/users/bind-phone`  
**æè¿°**: ç»‘å®šæˆ–æ›´æ¢æ‰‹æœºå·ï¼ˆéœ€è¦çŸ­ä¿¡éªŒè¯ç ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**å‰ç½®æ­¥éª¤**:

1. è°ƒç”¨å‘é€éªŒè¯ç æ¥å£ï¼š`POST /api/sms/send-code`
2. ç”¨æˆ·æ”¶åˆ°çŸ­ä¿¡éªŒè¯ç 
3. è°ƒç”¨æ­¤æ¥å£å®Œæˆç»‘å®š

**è¯·æ±‚ä½“**:

```json
{
  "phone": "13800138000",
  // ã€å¿…å¡«ã€‘è¦ç»‘å®šçš„æ‰‹æœºå·
  // è§„åˆ™ï¼š11ä½æ•°å­—
  // å”¯ä¸€æ€§ï¼šä¸èƒ½ä¸å…¶ä»–ç”¨æˆ·çš„æ‰‹æœºå·é‡å¤
  // æ ¼å¼ï¼šå¿…é¡»æ˜¯æœ‰æ•ˆçš„ä¸­å›½å¤§é™†æ‰‹æœºå·

  "verification_code": "123456"
  // ã€å¿…å¡«ã€‘çŸ­ä¿¡éªŒè¯ç 
  // è§„åˆ™ï¼š6ä½æ•°å­—
  // æœ‰æ•ˆæœŸï¼š5åˆ†é’Ÿ
  // éªŒè¯ï¼šåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ŒéªŒè¯åå¤±æ•ˆ
}
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æ‰‹æœºå·ç»‘å®šæˆåŠŸ",
  "data": {
    "phone": "13800138000"
    // å·²ç»‘å®šçš„æ‰‹æœºå·
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**é”™è¯¯å“åº”**:

```json
{
  "code": 400,
  "message": "éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ",
  "error": {
    "type": "ValidationError",
    "details": {
      "field": "verification_code",
      "reason": "éªŒè¯ç æ— æ•ˆï¼Œè¯·é‡æ–°è·å–"
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.7 å…³æ³¨ç”¨æˆ·

**æ¥å£**: `POST /api/users/{user_id}/follow`  
**æè¿°**: å…³æ³¨æŒ‡å®šç”¨æˆ·  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `user_id`:
  - ã€å¿…å¡«ã€‘è¦å…³æ³¨çš„ç”¨æˆ·ID
  - ç±»å‹ï¼šæ•´æ•°
  - é™åˆ¶ï¼šä¸èƒ½å…³æ³¨è‡ªå·±
  - ç¤ºä¾‹ï¼š`/api/users/2/follow`

**å“åº”**:

```json
{
  "code": 201,
  "message": "å…³æ³¨æˆåŠŸ",
  "data": {
    "follow": {
      "id": 1,
      // å…³æ³¨å…³ç³»ID

      "follower_id": 1,
      // å…³æ³¨è€…IDï¼ˆå½“å‰ç™»å½•ç”¨æˆ·ï¼‰

      "following_id": 2,
      // è¢«å…³æ³¨è€…IDï¼ˆè·¯å¾„å‚æ•°ä¸­çš„user_idï¼‰

      "created_at": "2025-12-03T10:00:00"
      // å…³æ³¨æ—¶é—´
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

1. æ£€æŸ¥æ˜¯å¦å·²ç»å…³æ³¨ï¼ˆé¿å…é‡å¤å…³æ³¨ï¼‰
2. æ£€æŸ¥æ˜¯å¦å…³æ³¨è‡ªå·±ï¼ˆä¸å…è®¸ï¼‰
3. åˆ›å»ºå…³æ³¨å…³ç³»è®°å½•
4. æ›´æ–°åŒæ–¹çš„å…³æ³¨/ç²‰ä¸è®¡æ•°
5. åˆ›å»ºé€šçŸ¥ï¼ˆé€šçŸ¥è¢«å…³æ³¨è€…ï¼‰

**é”™è¯¯å“åº”ï¼ˆé‡å¤å…³æ³¨ï¼‰**:

```json
{
  "code": 409,
  // 409è¡¨ç¤ºèµ„æºå†²çª

  "message": "å·²ç»å…³æ³¨è¿‡è¯¥ç”¨æˆ·",
  "error": {
    "type": "DuplicateError",
    "details": null
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.8 å–æ¶ˆå…³æ³¨

**æ¥å£**: `DELETE /api/users/{user_id}/follow`  
**æè¿°**: å–æ¶ˆå…³æ³¨æŒ‡å®šç”¨æˆ·  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `user_id`:
  - ã€å¿…å¡«ã€‘è¦å–æ¶ˆå…³æ³¨çš„ç”¨æˆ·ID
  - ç±»å‹ï¼šæ•´æ•°

**å“åº”**:

```json
{
  "code": 200,
  "message": "å–æ¶ˆå…³æ³¨æˆåŠŸ",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.9 è·å–å…³æ³¨åˆ—è¡¨

**æ¥å£**: `GET /api/users/{user_id}/following`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„å…³æ³¨åˆ—è¡¨  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `user_id`: ã€å¿…å¡«ã€‘ç”¨æˆ·ID

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20ï¼ŒèŒƒå›´1-50

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 2,
        // è¢«å…³æ³¨ç”¨æˆ·çš„ID

        "username": "artist1",
        "avatar": "avatars/artist1.jpg",
        "bio": "ä¹¦æ³•å®¶",

        "followers_count": 1000,
        // è¯¥ç”¨æˆ·çš„ç²‰ä¸æ•°

        "works_count": 50,
        // è¯¥ç”¨æˆ·çš„ä½œå“æ•°

        "is_following": true
        // å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å…³æ³¨äº†è¯¥ç”¨æˆ·ï¼ˆéœ€ç™»å½•æ‰æœ‰æ­¤å­—æ®µï¼‰
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 50,
      "total_pages": 3,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 2.10 è·å–ç²‰ä¸åˆ—è¡¨

**æ¥å£**: `GET /api/users/{user_id}/followers`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„ç²‰ä¸åˆ—è¡¨  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `user_id`: ã€å¿…å¡«ã€‘ç”¨æˆ·ID

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20

**å“åº”**: æ ¼å¼åŒå…³æ³¨åˆ—è¡¨

## 3. ä½œå“ç›¸å…³ API

### 3.1 è·å–ä½œå“åˆ—è¡¨

**æ¥å£**: `GET /api/works`  
**æè¿°**: è·å–ä½œå“åˆ—è¡¨ï¼Œæ”¯æŒå¤šæ¡ä»¶ç­›é€‰å’Œæ’åº  
**è®¤è¯**: æ— éœ€è®¤è¯

**æŸ¥è¯¢å‚æ•°**:

- `page`:
  
  - ã€å¯é€‰ã€‘é¡µç 
  - ç±»å‹ï¼šæ•´æ•°
  - é»˜è®¤å€¼ï¼š1
  - æœ€å°å€¼ï¼š1

- `per_page`:
  
  - ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡
  - ç±»å‹ï¼šæ•´æ•°
  - é»˜è®¤å€¼ï¼š12
  - èŒƒå›´ï¼š1-50

- `style`:
  
  - ã€å¯é€‰ã€‘ä¹¦æ³•é£æ ¼ç­›é€‰
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼šæ¥·ä¹¦ã€è¡Œä¹¦ã€è‰ä¹¦ã€éš¶ä¹¦ã€ç¯†ä¹¦
  - ç¤ºä¾‹ï¼š`?style=è¡Œä¹¦`

- `dynasty`:
  
  - ã€å¯é€‰ã€‘æœä»£ç­›é€‰
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼šå”ã€å®‹ã€å…ƒã€æ˜ã€æ¸…ã€ä¸œæ™‹ç­‰
  - ç¤ºä¾‹ï¼š`?dynasty=å”`

- `status`:
  
  - ã€å¯é€‰ã€‘å®¡æ ¸çŠ¶æ€ç­›é€‰
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼š
    - approved: å·²é€šè¿‡ï¼ˆé»˜è®¤ï¼‰
    - pending: å¾…å®¡æ ¸
    - rejected: å·²æ‹’ç»
  - é»˜è®¤å€¼ï¼šapproved
  - è¯´æ˜ï¼šæ™®é€šç”¨æˆ·åªèƒ½çœ‹åˆ°approvedï¼Œç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°æ‰€æœ‰çŠ¶æ€

- `search`:
  
  - ã€å¯é€‰ã€‘æœç´¢å…³é”®è¯
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - æœç´¢èŒƒå›´ï¼šä½œå“åç§°ã€åŸä½œè€…åã€æè¿°
  - ç¤ºä¾‹ï¼š`? search=å…°äº­`
  - è¯´æ˜ï¼šä½¿ç”¨æ¨¡ç³ŠåŒ¹é…

- `sort`:
  
  - ã€å¯é€‰ã€‘æ’åºå­—æ®µ
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼š
    - views: æŒ‰æµè§ˆé‡æ’åºï¼ˆé»˜è®¤ï¼‰
    - likes: æŒ‰ç‚¹èµæ•°æ’åº
    - created_at: æŒ‰åˆ›å»ºæ—¶é—´æ’åº
  - é»˜è®¤å€¼ï¼šviews

- `order`:
  
  - ã€å¯é€‰ã€‘æ’åºé¡ºåº
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼š
    - asc: å‡åº
    - desc: é™åºï¼ˆé»˜è®¤ï¼‰
  - é»˜è®¤å€¼ï¼šdesc

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /api/works?page=1&per_page=12&style=è¡Œä¹¦&dynasty=ä¸œæ™‹&sort=views&order=desc&search=å…°äº­
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,

        "title": "å…°äº­åº",
        // ä½œå“åç§°ï¼Œå¿…å¡«å­—æ®µ

        "description": "å¤©ä¸‹ç¬¬ä¸€è¡Œä¹¦ï¼Œç‹ç¾²ä¹‹ä»£è¡¨ä½œ",
        // ä½œå“æè¿°/ä»‹ç»ï¼Œå¯é€‰å­—æ®µ
        // å¯ä»¥åŒ…å«ä½œå“èƒŒæ™¯ã€åˆ›ä½œæ•…äº‹ç­‰

        "image_url": "/uploads/works/lantingxu.jpg",
        // ä½œå“å›¾ç‰‡URLï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
        // å®Œæ•´è®¿é—®ï¼šhttp://åŸŸå/uploads/works/lantingxu.jpg

        "style": "è¡Œä¹¦",
        // ä¹¦æ³•é£æ ¼
        // å¸¸è§å€¼ï¼šæ¥·ä¹¦ã€è¡Œä¹¦ã€è‰ä¹¦ã€éš¶ä¹¦ã€ç¯†ä¹¦ã€å°ç¯†ç­‰

        "dynasty": "ä¸œæ™‹",
        // æ‰€å±æœä»£
        // å¸¸è§å€¼ï¼šå…ˆç§¦ã€ç§¦ã€æ±‰ã€ä¸‰å›½ã€æ™‹ã€å—åŒ—æœã€éš‹ã€å”ã€å®‹ã€å…ƒã€æ˜ã€æ¸…

        "author_name": "ç‹ç¾²ä¹‹",
        // ä¹¦æ³•ä½œå“çš„åŸä½œè€…ï¼ˆå†å²äººç‰©ï¼‰
        // æ³¨æ„ï¼šè¿™ä¸æ˜¯ä¸Šä¼ è€…ï¼Œè€Œæ˜¯åˆ›ä½œè¯¥ä¹¦æ³•ä½œå“çš„å†å²äººç‰©

        "character_count": 324,
        // ä½œå“ä¸­è¯†åˆ«å‡ºçš„å•å­—æ•°é‡
        // æ¥æºï¼šOCRè¯†åˆ«æˆ–æ‰‹åŠ¨æ ‡æ³¨

        "views": 1000,
        // æµè§ˆæ¬¡æ•°
        // è®¡æ•°è§„åˆ™ï¼šæ¯æ¬¡è®¿é—®ä½œå“è¯¦æƒ…é¡µ +1
        // è¯´æ˜ï¼šåŒä¸€ç”¨æˆ·å¤šæ¬¡è®¿é—®ä¼šç´¯åŠ 

        "likes_count": 100,
        // ç‚¹èµæ•°
        // è®¡æ•°è§„åˆ™ï¼šæ¯ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡

        "comments_count": 50,
        // è¯„è®ºæ€»æ•°ï¼ˆåŒ…å«æ‰€æœ‰å±‚çº§çš„å›å¤ï¼‰

        "collections_count": 80,
        // æ”¶è—æ•°
        // è®¡æ•°è§„åˆ™ï¼šæ¯ä¸ªç”¨æˆ·åªèƒ½æ”¶è—ä¸€æ¬¡

        "status": "approved",
        // å®¡æ ¸çŠ¶æ€
        // pending: å¾…å®¡æ ¸ï¼ˆåˆšä¸Šä¼ ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼‰
        // approved: å·²é€šè¿‡ï¼ˆå¯ä»¥åœ¨åˆ—è¡¨ä¸­å±•ç¤ºï¼‰
        // rejected: å·²æ‹’ç»ï¼ˆä¸å±•ç¤ºï¼Œç”¨æˆ·å¯æŸ¥çœ‹æ‹’ç»åŸå› ï¼‰

        "created_at": "2025-12-03T10:00:00",
        // ä¸Šä¼ æ—¶é—´ï¼ˆISO 8601æ ¼å¼ï¼‰

        "author": {
        // ä¸Šä¼ è€…ä¿¡æ¯ï¼ˆå¹³å°ç”¨æˆ·ï¼‰
          "id": 1,
          "username": "admin",
          "avatar": "avatars/admin.jpg"
        }
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 12,
      "total": 100,
      "total_pages": 9,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 3.2 è·å–ä½œå“è¯¦æƒ…

**æ¥å£**: `GET /api/works/{work_id}`  
**æè¿°**: è·å–æŒ‡å®šä½œå“çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å•å­—åˆ—è¡¨  
**è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆä½†ç™»å½•åä¼šæ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼‰

**è·¯å¾„å‚æ•°**:

- `work_id`:
  - ã€å¿…å¡«ã€‘ä½œå“ID
  - ç±»å‹ï¼šæ•´æ•°

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "work": {
      "id": 1,
      "title": "å…°äº­åº",
      "description": "å¤©ä¸‹ç¬¬ä¸€è¡Œä¹¦",
      "image_url": "/uploads/works/lantingxu.jpg",
      "style": "è¡Œä¹¦",
      "dynasty": "ä¸œæ™‹",
      "author_name": "ç‹ç¾²ä¹‹",
      "character_count": 324,

      "views": 1001,
      // æµè§ˆé‡è‡ªåŠ¨+1

      "likes_count": 100,
      "comments_count": 50,
      "collections_count": 80,
      "status": "approved",
      "reject_reason": null,
      // æ‹’ç»åŸå› ï¼Œä»…å½“statusä¸ºrejectedæ—¶æœ‰å€¼

      "created_at": "2025-12-03T10:00:00",
      "updated_at": "2025-12-03T10:00:00",

      "author": {
        "id": 1,
        "username": "admin",
        "avatar": "avatars/admin. jpg"
      },

      "is_liked": false,
      // å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµï¼ˆéœ€ç™»å½•ï¼Œæœªç™»å½•è¿”å›falseï¼‰

      "is_collected": false,
      // å½“å‰ç”¨æˆ·æ˜¯å¦å·²æ”¶è—ï¼ˆéœ€ç™»å½•ï¼Œæœªç™»å½•è¿”å›falseï¼‰

      "characters": [
      // ä½œå“ä¸­çš„å•å­—åˆ—è¡¨ï¼ˆéƒ¨åˆ†ï¼ŒæŒ‰ä½ç½®æ’åºï¼‰
        {
          "id": 1,
          "text": "æ°¸",
          // å•å­—å†…å®¹

          "position": [100, 200, 150, 250],
          // å•å­—åœ¨å›¾ç‰‡ä¸­çš„ä½ç½®[x1,y1,x2,y2]ï¼Œå•ä½åƒç´ 

          "stroke_count": 5,
          // ç¬”ç”»æ•°

          "image_url": "/uploads/characters/char_1.jpg",
          // å•å­—æˆªå›¾URL

          "annotations_count": 3
          // è¯¥å•å­—çš„è¯»å¸–æ•°é‡
        }
      ]
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**æ³¨æ„äº‹é¡¹**:

- æ¯æ¬¡è®¿é—®æ­¤æ¥å£ï¼Œä½œå“çš„viewså­—æ®µä¼šè‡ªåŠ¨+1
- charactersæ•°ç»„é»˜è®¤åªè¿”å›å‰20ä¸ªï¼Œå®Œæ•´åˆ—è¡¨è¯·ä½¿ç”¨ `/api/works/{work_id}/characters`

---

### 3.3 åˆ›å»ºä½œå“ï¼ˆä¸Šä¼ ä½œå“ï¼‰

**æ¥å£**: `POST /api/works`  
**æè¿°**: ä¸Šä¼ æ–°ä½œå“ï¼Œæ”¯æŒOCRå•å­—åˆ†å‰²  
**è®¤è¯**: éœ€è¦ Access Token  
**Content-Type**: `multipart/form-data`

**è¯·æ±‚ä½“ï¼ˆè¡¨å•æ•°æ®ï¼‰**:

- `image`:
  
  - ã€å¿…å¡«ã€‘ä½œå“å›¾ç‰‡æ–‡ä»¶
  - æ”¯æŒæ ¼å¼ï¼šjpgã€pngã€jpeg
  - æ–‡ä»¶å¤§å°ï¼šæœ€å¤§10MB
  - å»ºè®®ï¼šé«˜æ¸…æ‰«æä»¶æˆ–é«˜è´¨é‡ç…§ç‰‡

- `title`:
  
  - ã€å¿…å¡«ã€‘ä½œå“åç§°
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - è§„åˆ™ï¼š1-200ä¸ªå­—ç¬¦
  - ç¤ºä¾‹ï¼š"å…°äº­åº"

- `description`:
  
  - ã€å¯é€‰ã€‘ä½œå“ä»‹ç»/æè¿°
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - è§„åˆ™ï¼šæœ€å¤š2000å­—
  - ç”¨é€”ï¼šä½œå“èƒŒæ™¯ã€åˆ›ä½œæ•…äº‹ç­‰

- `style`:
  
  - ã€å¯é€‰ã€‘ä¹¦æ³•é£æ ¼
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼šæ¥·ä¹¦ã€è¡Œä¹¦ã€è‰ä¹¦ã€éš¶ä¹¦ã€ç¯†ä¹¦ç­‰
  - ç¤ºä¾‹ï¼š"è¡Œä¹¦"

- `dynasty`:
  
  - ã€å¯é€‰ã€‘æ‰€å±æœä»£
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - å¯é€‰å€¼ï¼šå”ã€å®‹ã€å…ƒã€æ˜ã€æ¸…ç­‰
  - ç¤ºä¾‹ï¼š"ä¸œæ™‹"

- `author_name`:
  
  - ã€å¯é€‰ã€‘ä¹¦æ³•ä½œå“çš„åŸä½œè€…å§“å
  - ç±»å‹ï¼šå­—ç¬¦ä¸²
  - è§„åˆ™ï¼š1-100ä¸ªå­—ç¬¦
  - ç¤ºä¾‹ï¼š"ç‹ç¾²ä¹‹"

- `characters_data`:
  
  - ã€å¯é€‰ã€‘å•å­—æ•°æ®ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰
  - ç±»å‹ï¼šJSONå­—ç¬¦ä¸²
  - æ ¼å¼ï¼šè§ä¸‹æ–¹è¯´æ˜
  - æ¥æºï¼šOCRè¯†åˆ«ç»“æœ

**characters_data æ ¼å¼è¯´æ˜**:

```json
[
  {
    "text": "æ°¸",
    // ã€å¿…å¡«ã€‘å•å­—å†…å®¹

    "position": [100, 200, 150, 250],
    // ã€å¿…å¡«ã€‘ä½ç½®åæ ‡[x1,y1,x2,y2]
    // è¯´æ˜ï¼šå·¦ä¸Šè§’åæ ‡(x1,y1)å’Œå³ä¸‹è§’åæ ‡(x2,y2)

    "stroke_count": 5,
    // ã€å¯é€‰ã€‘ç¬”ç”»æ•°

    "stroke_order": "ç‚¹ã€æ¨ªã€ç«–ã€æ’‡ã€æº",
    // ã€å¯é€‰ã€‘ç¬”é¡ºæè¿°

    "ocr_confidence": 0.98
    // ã€å¯é€‰ã€‘OCRè¯†åˆ«ç½®ä¿¡åº¦ï¼Œ0-1ä¹‹é—´
  },
  {
    "text": "å’Œ",
    "position": [160, 200, 210, 250],
    "stroke_count": 8,
    "ocr_confidence": 0.96
  }
]
```

**è¯·æ±‚ç¤ºä¾‹ï¼ˆä½¿ç”¨curlï¼‰**:

```bash
curl -X POST http://localhost:5000/api/works \
  -H "Authorization: Bearer <access_token>" \
  -F "image=@lantingxu.jpg" \
  -F "title=å…°äº­åº" \
  -F "description=å¤©ä¸‹ç¬¬ä¸€è¡Œä¹¦" \
  -F "style=è¡Œä¹¦" \
  -F "dynasty=ä¸œæ™‹" \
  -F "author_name=ç‹ç¾²ä¹‹" \
  -F 'characters_data=[{"text":"æ°¸","position":[100,200,150,250],"stroke_count":5}]'
```

**å“åº”**:

```json
{
  "code": 201,
  "message": "ä½œå“åˆ›å»ºæˆåŠŸï¼Œç­‰å¾…å®¡æ ¸",
  "data": {
    "work": {
      "id": 1,
      "title": "å…°äº­åº",

      "status": "pending",
      // åˆå§‹çŠ¶æ€ä¸ºå¾…å®¡æ ¸

      "image_url": "/uploads/works/work_1_20251203.jpg",

      "character_count": 2,
      // æ ¹æ®characters_dataè‡ªåŠ¨è®¡ç®—

      "views": 0,
      "likes_count": 0,
      "comments_count": 0,
      "collections_count": 0,
      "created_at": "2025-12-03T10:00:00",

      "author": {
        "id": 1,
        "username": "testuser",
        "avatar": "avatars/user1.jpg"
      }
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡æµç¨‹**:

1. éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
2. ä¿å­˜å›¾ç‰‡æ–‡ä»¶
3. è§£æcharacters_dataï¼ˆå¦‚æœæä¾›ï¼‰
4. åˆ›å»ºä½œå“è®°å½•ï¼ˆstatus=pendingï¼‰
5. åˆ›å»ºå•å­—è®°å½•ï¼ˆå¦‚æœæœ‰characters_dataï¼‰
6. è¿”å›ä½œå“ä¿¡æ¯
7. é€šçŸ¥ç®¡ç†å‘˜å®¡æ ¸

---

### 3.4 æ›´æ–°ä½œå“

**æ¥å£**: `PUT /api/works/{work_id}`  
**æè¿°**: æ›´æ–°ä½œå“ä¿¡æ¯ï¼ˆä»…ä½œè€…æˆ–ç®¡ç†å‘˜å¯æ“ä½œï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**è¯·æ±‚ä½“**:

```json
{
  "title": "å…°äº­åºï¼ˆä¿®æ­£ç‰ˆï¼‰",
  // ã€å¯é€‰ã€‘æ–°çš„ä½œå“åç§°

  "description": "æ›´æ–°åçš„æè¿°",
  // ã€å¯é€‰ã€‘æ–°çš„ä½œå“æè¿°

  "style": "è¡Œä¹¦",
  // ã€å¯é€‰ã€‘æ–°çš„ä¹¦æ³•é£æ ¼

  "dynasty": "ä¸œæ™‹",
  // ã€å¯é€‰ã€‘æ–°çš„æœä»£

  "author_name": "ç‹ç¾²ä¹‹"
  // ã€å¯é€‰ã€‘æ–°çš„åŸä½œè€…å
}
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "work": {
      // æ›´æ–°åçš„å®Œæ•´ä½œå“ä¿¡æ¯
      "id": 1,
      "title": "å…°äº­åºï¼ˆä¿®æ­£ç‰ˆï¼‰",
      "description": "æ›´æ–°åçš„æè¿°",
      "updated_at": "2025-12-03T11:00:00"
      // ... å…¶ä»–å­—æ®µ
    }
  },
  "timestamp": "2025-12-03T11:00:00+08:00"
}
```

**æƒé™è¯´æ˜**:

- ä»…ä½œå“çš„ä¸Šä¼ è€…å¯ä»¥ä¿®æ”¹
- ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹ä»»ä½•ä½œå“
- ä¿®æ”¹åä¸ä¼šæ”¹å˜å®¡æ ¸çŠ¶æ€

---

### 3.5 åˆ é™¤ä½œå“

**æ¥å£**: `DELETE /api/works/{work_id}`  
**æè¿°**: åˆ é™¤ä½œå“ï¼ˆä»…ä½œè€…æˆ–ç®¡ç†å‘˜å¯æ“ä½œï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**å“åº”**:

```json
{
  "code": 204,
  // 204è¡¨ç¤ºæˆåŠŸä¸”æ— è¿”å›å†…å®¹

  "message": "åˆ é™¤æˆåŠŸ",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**çº§è”åˆ é™¤è¯´æ˜**:  
åˆ é™¤ä½œå“ä¼šåŒæ—¶åˆ é™¤ï¼š

- è¯¥ä½œå“çš„æ‰€æœ‰å•å­—è®°å½•
- è¯¥ä½œå“çš„æ‰€æœ‰è¯„è®º
- è¯¥ä½œå“çš„æ‰€æœ‰ç‚¹èµè®°å½•
- è¯¥ä½œå“çš„æ‰€æœ‰æ”¶è—è®°å½•
- è¯¥ä½œå“çš„å›¾ç‰‡æ–‡ä»¶
- ç›¸å…³çš„é€šçŸ¥è®°å½•

**æ³¨æ„**: æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ

---

### 3.6 ç‚¹èµä½œå“

**æ¥å£**: `POST /api/works/{work_id}/like`  
**æè¿°**: ç»™ä½œå“ç‚¹èµï¼ˆé‡å¤ç‚¹èµæ— æ•ˆï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**å“åº”**:

```json
{
  "code": 201,
  "message": "ç‚¹èµæˆåŠŸ",
  "data": {
    "is_liked": true,
    // å½“å‰ç‚¹èµçŠ¶æ€

    "likes_count": 101
    // æ›´æ–°åçš„ç‚¹èµæ€»æ•°
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

1. æ£€æŸ¥æ˜¯å¦å·²ç‚¹èµï¼ˆé¿å…é‡å¤ï¼‰
2. åˆ›å»ºç‚¹èµè®°å½•
3. æ›´æ–°ä½œå“çš„likes_count
4. åˆ›å»ºé€šçŸ¥ï¼ˆé€šçŸ¥ä½œå“ä½œè€…ï¼‰

**é”™è¯¯å“åº”ï¼ˆå·²ç‚¹èµï¼‰**:

```json
{
  "code": 409,
  "message": "å·²ç»ç‚¹èµè¿‡äº†",
  "error": {
    "type": "DuplicateError",
    "details": null
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 3.7 å–æ¶ˆç‚¹èµ

**æ¥å£**: `DELETE /api/works/{work_id}/like`  
**æè¿°**: å–æ¶ˆå¯¹ä½œå“çš„ç‚¹èµ  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "å–æ¶ˆç‚¹èµæˆåŠŸ",
  "data": {
    "is_liked": false,
    "likes_count": 100
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 3.8 å¤ç±OCRè¯†åˆ«

**æ¥å£**: `POST /api/works/ocr`  
**æè¿°**: è°ƒç”¨å¤ç±OCRæœåŠ¡è¯†åˆ«å›¾ç‰‡ä¸­çš„å•å­—å¹¶è¿”å›ä½ç½®ä¿¡æ¯  
**è®¤è¯**: æ— éœ€è®¤è¯

**è¯·æ±‚ä½“**:

```json
{
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRg.. .",
  // ã€å¿…å¡«ã€‘base64ç¼–ç çš„å›¾ç‰‡å­—ç¬¦ä¸²
  // æ ¼å¼ï¼šå¿…é¡»åŒ…å«data URIå‰ç¼€ï¼ˆdata:image/ç±»å‹;base64,ï¼‰
  // æ”¯æŒæ ¼å¼ï¼šjpegã€pngã€jpg
  // å¤§å°é™åˆ¶ï¼šç¼–ç åä¸è¶…è¿‡10MB

  "det_mode": "auto",
  // ã€å¯é€‰ã€‘æ£€æµ‹æ¨¡å¼
  // å¯é€‰å€¼ï¼š
  //   - auto: è‡ªåŠ¨æ£€æµ‹æ–‡å­—æ’åˆ—æ–¹å¼ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰
  //   - single: å¼ºåˆ¶å•åˆ—æ£€æµ‹ï¼ˆé€‚ç”¨äºç«–æ’å•åˆ—ï¼‰
  //   - double: å¼ºåˆ¶åŒåˆ—æ£€æµ‹ï¼ˆé€‚ç”¨äºç«–æ’åŒåˆ—ï¼‰
  // é»˜è®¤å€¼ï¼šauto

  "version": "v2",
  // ã€å¯é€‰ã€‘OCRç‰ˆæœ¬
  // å¯é€‰å€¼ï¼š
  //   - v1: æ—§ç‰ˆOCRå¼•æ“
  //   - v2: æ–°ç‰ˆOCRå¼•æ“ï¼Œå‡†ç¡®ç‡æ›´é«˜ï¼ˆæ¨èï¼‰
  // é»˜è®¤å€¼ï¼šv2

  "return_position": true
  // ã€å¯é€‰ã€‘æ˜¯å¦è¿”å›ä½ç½®ä¿¡æ¯
  // ç±»å‹ï¼šå¸ƒå°”å€¼
  // é»˜è®¤å€¼ï¼štrue
  // è¯´æ˜ï¼šå¿…é¡»ä¸ºtrueæ‰èƒ½è·å–å•å­—ä½ç½®åæ ‡
}
```

**å‚æ•°è¯´æ˜**:

- `det_mode`è¯¦è§£ï¼š
  
  - `auto`: é€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µï¼ŒAIè‡ªåŠ¨åˆ¤æ–­æ–‡å­—å¸ƒå±€
  - `single`: é€‚ç”¨äºä¼ ç»Ÿå•åˆ—ç«–æ’ä¹¦æ³•
  - `double`: é€‚ç”¨äºä¼ ç»ŸåŒåˆ—ç«–æ’ä¹¦æ³•

- `version`è¯¦è§£ï¼š
  
  - `v2`: åŸºäºæ·±åº¦å­¦ä¹ ï¼Œè¯†åˆ«å‡†ç¡®ç‡æ›´é«˜ï¼Œæ¨èä½¿ç”¨
  - `v1`: ä¼ ç»ŸOCRç®—æ³•ï¼Œå…¼å®¹æ€§æ›´å¥½

**å“åº”**:

```json
{
  "code": 200,
  "message": "è¯†åˆ«æˆåŠŸ",
  "data": {
    "temp_json_path": "json_temp/ocr_20251203120000_abc123.json",
    // å®Œæ•´OCRç»“æœçš„ä¸´æ—¶ä¿å­˜è·¯å¾„
    // è¯´æ˜ï¼šæœåŠ¡å™¨ä¼šä¿å­˜å®Œæ•´çš„OCRåŸå§‹ç»“æœï¼Œæœ‰æ•ˆæœŸ24å°æ—¶
    // ç”¨é€”ï¼šç”¨äºè°ƒè¯•å’Œé—®é¢˜è¿½æº¯

    "boxes": [
    // è¯†åˆ«å‡ºçš„å•å­—åˆ—è¡¨
      {
        "text": "æ°¸",
        // è¯†åˆ«å‡ºçš„æ–‡å­—å†…å®¹

        "position": [100, 200, 150, 250],
        // ä½ç½®åæ ‡[x1, y1, x2, y2]
        // x1,y1: å·¦ä¸Šè§’åæ ‡
        // x2,y2: å³ä¸‹è§’åæ ‡
        // å•ä½ï¼šåƒç´ 

        "confidence": 0.98,
        // æ–‡å­—è¯†åˆ«ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
        // è¯´æ˜ï¼šå€¼è¶Šé«˜è¡¨ç¤ºè¯†åˆ«è¶Šå‡†ç¡®
        // å»ºè®®ï¼šconfidence < 0.8 çš„ç»“æœéœ€è¦äººå·¥å¤æ ¸

        "det_confidence": 0.95,
        // ä½ç½®æ£€æµ‹ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
        // è¯´æ˜ï¼šå€¼è¶Šé«˜è¡¨ç¤ºä½ç½®æ¡†å®šè¶Šå‡†ç¡®

        "line_index": 0,
        // æ‰€åœ¨è¡Œç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
        // è¯´æ˜ï¼šç”¨äºåŒºåˆ†ä¸åŒè¡Œçš„æ–‡å­—

        "word_index": 0
        // åœ¨è¡Œå†…çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
        // è¯´æ˜ï¼šè¡¨ç¤ºè¯¥å­—åœ¨å½“å‰è¡Œçš„ç¬¬å‡ ä¸ªä½ç½®
      },
      {
        "text": "å’Œ",
        "position": [160, 200, 210, 250],
        "confidence": 0.96,
        "det_confidence": 0. 94,
        "line_index": 0,
        "word_index": 1
      }
    ],

    "image_size": {
    // åŸå§‹å›¾ç‰‡å°ºå¯¸
      "width": 1920,
      "height": 1080
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä½¿ç”¨æµç¨‹**:

1. å‰ç«¯å°†å›¾ç‰‡è½¬ä¸ºbase64ç¼–ç 
2. è°ƒç”¨æ­¤æ¥å£è¿›è¡ŒOCRè¯†åˆ«
3. è·å–è¯†åˆ«ç»“æœä¸­çš„boxesæ•°ç»„
4. ï¼ˆå¯é€‰ï¼‰å‰ç«¯å±•ç¤ºè¯†åˆ«ç»“æœï¼Œå…è®¸ç”¨æˆ·ä¿®æ­£
5. å°†boxesæ•°æ®ä½œä¸ºcharacters_dataå‚æ•°ä¼ ç»™åˆ›å»ºä½œå“æ¥å£

**é”™è¯¯å“åº”ï¼ˆOCRæœåŠ¡è°ƒç”¨å¤±è´¥ï¼‰**:

```json
{
  "code": 502,
  "message": "OCRæœåŠ¡è°ƒç”¨å¤±è´¥",
  "error": {
    "type": "ExternalAPIError",
    "details": "OCR API è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**æ³¨æ„äº‹é¡¹**:

- OCRæœåŠ¡ç”±ç¬¬ä¸‰æ–¹æä¾›ï¼ˆçœ‹å…¸å¤ç±ï¼‰ï¼Œéœ€è¦é…ç½®APIå¯†é’¥
- è¯†åˆ«å‡†ç¡®ç‡å—å›¾ç‰‡è´¨é‡å½±å“ï¼Œå»ºè®®ä½¿ç”¨é«˜æ¸…å›¾ç‰‡
- base64ç¼–ç ä¼šä½¿æ•°æ®é‡å¢å¤§çº¦1.33å€
- è¯†åˆ«å¤æ‚ä¹¦æ³•å¯èƒ½è€—æ—¶è¾ƒé•¿ï¼ˆ5-30ç§’ï¼‰

---

## 4. å•å­—/å­—é›†ç›¸å…³ API

### 4.1 è·å–ä½œå“çš„å•å­—åˆ—è¡¨

**æ¥å£**: `GET /api/works/{work_id}/characters`  
**æè¿°**: è·å–æŒ‡å®šä½œå“ä¸­çš„æ‰€æœ‰å•å­—  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**æŸ¥è¯¢å‚æ•°**:

- `page`:
  
  - ã€å¯é€‰ã€‘é¡µç 
  - é»˜è®¤å€¼ï¼š1

- `per_page`:
  
  - ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡
  - é»˜è®¤å€¼ï¼š50
  - èŒƒå›´ï¼š1-100

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,

        "text": "æ°¸",
        // å•å­—å†…å®¹

        "work_id": 1,
        // æ‰€å±ä½œå“ID

        "position": [100, 200, 150, 250],
        // åœ¨ä½œå“å›¾ç‰‡ä¸­çš„ä½ç½®åæ ‡[x1,y1,x2,y2]
        // å•ä½ï¼šåƒç´ 

        "stroke_count": 5,
        // ç¬”ç”»æ•°

        "stroke_order": "ç‚¹ã€æ¨ªã€ç«–ã€æ’‡ã€æº",
        // ç¬”é¡ºæè¿°
        // æ ¼å¼ï¼šç”¨é¡¿å·åˆ†éš”çš„ç¬”ç”»åç§°

        "image_url": "/uploads/characters/char_1.jpg",
        // å•å­—æˆªå›¾URL
        // è¯´æ˜ï¼šä»åŸä½œå“å›¾ç‰‡ä¸­æ ¹æ®positionè£å‰ªå¾—åˆ°

        "ocr_confidence": 0.98,
        // OCRè¯†åˆ«ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰

        "annotations_count": 3,
        // è¯¥å•å­—çš„è¯»å¸–æ•°é‡
        // è¯´æ˜ï¼šåŒ…å«å…¬å¼€çš„è¯»å¸–æ³¨é‡Š

        "created_at": "2025-12-03T10:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 50,
      "total": 324,
      // è¯¥ä½œå“å…±324ä¸ªå•å­—

      "total_pages": 7,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 4.2 è·å–å•å­—è¯¦æƒ…

**æ¥å£**: `GET /api/characters/{character_id}`  
**æè¿°**: è·å–å•å­—çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰è¯»å¸–æ³¨é‡Š  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `character_id`: ã€å¿…å¡«ã€‘å•å­—ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "character": {
      "id": 1,
      "text": "æ°¸",
      "work_id": 1,
      "position": [100, 200, 150, 250],
      "stroke_count": 5,
      "stroke_order": "ç‚¹ã€æ¨ªã€ç«–ã€æ’‡ã€æº",
      "image_url": "/uploads/characters/char_1.jpg",
      "ocr_confidence": 0.98,
      "annotations_count": 3,
      "created_at": "2025-12-03T10:00:00",

      "work": {
      // æ‰€å±ä½œå“ä¿¡æ¯
        "id": 1,
        "title": "å…°äº­åº",
        "style": "è¡Œä¹¦",
        "dynasty": "ä¸œæ™‹",
        "author_name": "ç‹ç¾²ä¹‹"
      },

      "annotations": [
      // è¯¥å•å­—çš„æ‰€æœ‰å…¬å¼€è¯»å¸–æ³¨é‡Š
        {
          "id": 1,
          "user_id": 1,

          "source": "ai",
          // æ¥æº
          // å¯é€‰å€¼ï¼š
          //   - ai: AIç”Ÿæˆ
          //   - manual: æ‰‹åŠ¨æ·»åŠ 

          "keypoints": [
          // å…³é”®ç‚¹æ•°ç»„
            {
              "id": 1,
              "x": 0.5,
              // xåæ ‡ï¼ˆç›¸å¯¹åæ ‡ï¼Œ0-1ä¹‹é—´ï¼‰

              "y": 0.3,
              // yåæ ‡ï¼ˆç›¸å¯¹åæ ‡ï¼Œ0-1ä¹‹é—´ï¼‰

              "description": "æ¨ªç”»èµ·ç¬”å¤„",
              // ä½ç½®æè¿°

              "tips": "æ³¨æ„è—é”‹èµ·ç¬”ï¼Œç¬”å°–è½»è§¦çº¸é¢"
              // ä¸´æ‘¹è¦ç‚¹
            }
          ],

          "overall_tips": "æ°¸å­—å…«æ³•æ˜¯ä¹¦æ³•åŸºç¡€",
          // æ•´ä½“ä¸´æ‘¹å»ºè®®

          "is_public": true,
          // æ˜¯å¦å…¬å¼€

          "created_at": "2025-12-03T10:00:00",

          "user": {
          // åˆ›å»ºè€…ä¿¡æ¯
            "id": 1,
            "username": "user1",
            "avatar": "avatars/user1.jpg"
          }
        }
      ]
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 4.3 è·å–æˆ‘çš„å­—é›†

**æ¥å£**: `GET /api/characters/my-collection`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·æ”¶è—çš„å•å­—åˆ—è¡¨  
**è®¤è¯**: éœ€è¦ Access Token

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20
- `style`: ã€å¯é€‰ã€‘æŒ‰å­—ä½“ç­›é€‰ï¼Œå¦‚ï¼šè¡Œä¹¦ã€æ¥·ä¹¦
- `text`: ã€å¯é€‰ã€‘æŒ‰å­—åæœç´¢ï¼Œæ”¯æŒæ¨¡ç³Šæœç´¢

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /api/characters/my-collection?page=1&per_page=20&style=è¡Œä¹¦&text=æ°¸
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "text": "æ°¸",
        "image_url": "/uploads/characters/char_1.jpg",

        "work": {
        // æ‰€å±ä½œå“ä¿¡æ¯
          "id": 1,
          "title": "å…°äº­åº",
          "style": "è¡Œä¹¦",
          "author_name": "ç‹ç¾²ä¹‹"
        },

        "has_annotation": true,
        // æ˜¯å¦å·²æ·»åŠ è¯»å¸–
        // true: å·²æœ‰è¯»å¸–æ³¨é‡Š
        // false: å°šæœªæ·»åŠ è¯»å¸–

        "collected_at": "2025-12-03T10:00:00"
        // æ”¶è—æ—¶é—´
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 50,
      "total_pages": 3,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 4.4 æ·»åŠ å•å­—åˆ°æˆ‘çš„å­—é›†

**æ¥å£**: `POST /api/characters/{character_id}/collect`  
**æè¿°**: å°†å•å­—æ·»åŠ åˆ°æˆ‘çš„å­—é›†  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `character_id`: ã€å¿…å¡«ã€‘å•å­—ID

**å“åº”**:

```json
{
  "code": 201,
  "message": "æ·»åŠ æˆåŠŸ",
  "data": {
    "character_id": 1,
    "collected_at": "2025-12-03T10:00:00"
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

- æ£€æŸ¥æ˜¯å¦å·²æ”¶è—ï¼ˆé¿å…é‡å¤ï¼‰
- åˆ›å»ºæ”¶è—è®°å½•
- å¯ä»¥ç¨åä¸ºè¯¥å•å­—æ·»åŠ è¯»å¸–æ³¨é‡Š

---

### 4.5 ä»å­—é›†ç§»é™¤å•å­—

**æ¥å£**: `DELETE /api/characters/{character_id}/collect`  
**æè¿°**: ä»æˆ‘çš„å­—é›†ä¸­ç§»é™¤å•å­—  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `character_id`: ã€å¿…å¡«ã€‘å•å­—ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "ç§»é™¤æˆåŠŸ",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**æ³¨æ„**: ç§»é™¤å•å­—ä¸ä¼šåˆ é™¤è¯¥å•å­—çš„è¯»å¸–æ³¨é‡Š

---

## 5. è¯»å¸–ç›¸å…³ APIï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 5.1 AIæ™ºèƒ½åˆ†æå•å­—

**æ¥å£**: `POST /api/calligraphy/analyze`  
**æè¿°**: ä½¿ç”¨è±†åŒ…AIè§†è§‰æ¨¡å‹åˆ†æä¹¦æ³•å•å­—ï¼Œè‡ªåŠ¨æ ‡æ³¨å…³é”®ç‚¹å’Œä¸´æ‘¹è¦ç‚¹  
**è®¤è¯**: å¯é€‰ï¼ˆæœªç™»å½•ä¹Ÿå¯ä½¿ç”¨ï¼‰  
**Content-Type**: `multipart/form-data`

**è¯·æ±‚ä½“ï¼ˆè¡¨å•æ•°æ®ï¼‰**:

- `image`:
  - ã€å¿…å¡«ã€‘å•å­—å›¾ç‰‡æ–‡ä»¶
  - æ”¯æŒæ ¼å¼ï¼šjpgã€pngã€webp
  - æ–‡ä»¶å¤§å°ï¼šæœ€å¤§10MB
  - å»ºè®®å°ºå¯¸ï¼š300x300åƒç´ ä»¥ä¸Š
  - å»ºè®®å†…å®¹ï¼šæ¸…æ™°çš„å•ä¸ªæ±‰å­—ä¹¦æ³•å›¾ç‰‡
  - æ³¨æ„ï¼šå›¾ç‰‡è´¨é‡ç›´æ¥å½±å“AIåˆ†æå‡†ç¡®åº¦

**AIåˆ†æåŸç†å’Œæµç¨‹**:

```
1. ç”¨æˆ·ä¸Šä¼ å•å­—å›¾ç‰‡
   â†“
2. åç«¯éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
   â†“
3. å›¾ç‰‡è‡ªåŠ¨è°ƒæ•´å°ºå¯¸ï¼ˆç¡®ä¿è¾¹é•¿â‰¥300pxï¼‰
   â†“
4. è½¬æ¢ä¸ºbase64ç¼–ç 
   â†“
5. è°ƒç”¨è±†åŒ…è§†è§‰æ¨¡å‹ APIï¼ˆdoubao-1.5-vision-pro-32kï¼‰
   â†“
6. AIæ ¹æ®å­—çš„å¤æ‚åº¦æ ‡æ³¨1-5ä¸ªå…³é”®ç‚¹
   - ç®€å•çš„å­—ï¼ˆå¦‚"ä¸€"ã€"äºŒ"ï¼‰ï¼š1-2ä¸ªå…³é”®ç‚¹
   - ä¸­ç­‰å¤æ‚åº¦ï¼ˆå¦‚"æ°¸"ã€"å’Œ"ï¼‰ï¼š3-4ä¸ªå…³é”®ç‚¹
   - å¤æ‚çš„å­—ï¼ˆå¦‚"é¾"ã€"é¬±"ï¼‰ï¼š4-5ä¸ªå…³é”®ç‚¹
   â†“
7. AIç”Ÿæˆæ¯ä¸ªå…³é”®ç‚¹çš„ä½ç½®æè¿°å’Œä¸´æ‘¹è¦ç‚¹
   â†“
8. è¿”å›JSONæ ¼å¼çš„åˆ†æç»“æœ
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "åˆ†ææˆåŠŸ",
  "data": {
    "character": "æ°¸",
    // AIè¯†åˆ«å‡ºçš„å­—
    // è¯´æ˜ï¼šåŸºäºè§†è§‰è¯†åˆ«ï¼Œå¯èƒ½ä¸å®é™…å­—æœ‰åå·®

    "complexity": "ä¸­ç­‰",
    // å­—çš„å¤æ‚ç¨‹åº¦
    // å¯é€‰å€¼ï¼šç®€å•ã€ä¸­ç­‰ã€å¤æ‚
    // åˆ¤æ–­ä¾æ®ï¼šç¬”ç”»æ•°ã€ç»“æ„å¤æ‚åº¦ã€ä¹¦å†™éš¾åº¦

    "keypoints": [
    // å…³é”®ç‚¹æ•°ç»„
    // æ•°é‡ï¼šæ ¹æ®complexityå†³å®šï¼Œ1-5ä¸ª
      {
        "id": 1,

        "x": 0.5,
        // xåæ ‡ï¼ˆç›¸å¯¹åæ ‡ï¼‰
        // èŒƒå›´ï¼š0-1ä¹‹é—´çš„å°æ•°
        // è¯´æ˜ï¼š0è¡¨ç¤ºå›¾ç‰‡æœ€å·¦ä¾§ï¼Œ1è¡¨ç¤ºæœ€å³ä¾§ï¼Œ0.5è¡¨ç¤ºæ°´å¹³ä¸­å¿ƒ
        // è®¡ç®—åƒç´ åæ ‡ï¼špixel_x = x * image_width

        "y": 0.3,
        // yåæ ‡ï¼ˆç›¸å¯¹åæ ‡ï¼‰
        // èŒƒå›´ï¼š0-1ä¹‹é—´çš„å°æ•°
        // è¯´æ˜ï¼š0è¡¨ç¤ºå›¾ç‰‡æœ€é¡¶éƒ¨ï¼Œ1è¡¨ç¤ºæœ€åº•éƒ¨ï¼Œ0.3è¡¨ç¤ºè·ç¦»é¡¶éƒ¨30%çš„ä½ç½®
        // è®¡ç®—åƒç´ åæ ‡ï¼špixel_y = y * image_height

        "description": "æ¨ªç”»èµ·ç¬”å¤„",
        // è¯¥ç‚¹çš„ä½ç½®æè¿°
        // è¯´æ˜ï¼šå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªç‚¹æ ‡æ³¨çš„æ˜¯ä»€ä¹ˆä½ç½®
        // å¸¸è§ä½ç½®ï¼šèµ·ç¬”ã€æ”¶ç¬”ã€è½¬æŠ˜ã€äº¤å‰ç‚¹ç­‰

        "tips": "æ³¨æ„è—é”‹èµ·ç¬”ï¼Œç¬”å°–è½»è§¦çº¸é¢åå‘å³ç¼“ç¼“æ¨è¿›ï¼ŒåŠ›åº¦è¦å‡åŒ€"
        // ä¸´æ‘¹è¦ç‚¹
        // è¯´æ˜ï¼šå…·ä½“çš„ä¹¦å†™æŠ€å·§å’Œæ³¨æ„äº‹é¡¹
        // å†…å®¹ï¼šèµ·ç¬”æ–¹å¼ã€è¿ç¬”æŠ€å·§ã€åŠ›åº¦æ§åˆ¶ã€ç¬”åŠ¿ç­‰
      },
      {
        "id": 2,
        "x": 0.45,
        "y": 0.6,
        "description": "ç«–ç”»ä¸æ¨ªç”»äº¤å‰ç‚¹",
        "tips": "æ­¤å¤„éœ€è¦ç¬”ç”»äº¤å‰è‡ªç„¶ï¼Œç«–ç”»ç©¿è¿‡æ¨ªç”»æ—¶è¦ä¿æŒåŠ›åº¦ï¼Œä¸å¯åƒµç¡¬"
      },
      {
        "id": 3,
        "x": 0.7,
        "y": 0.8,
        "description": "æºç”»å‡ºé”‹å¤„",
        "tips": "æºç”»è¦æœ‰åŠ›åº¦ï¼Œç”±ç²—åˆ°ç»†ï¼Œå‡ºé”‹è¦å¹²è„†åˆ©è½ï¼Œå±•ç°ç¬”åŠ¿"
      }
    ],

    "overall_tips": "æ°¸å­—å…«æ³•æ˜¯å­¦ä¹ ä¹¦æ³•çš„åŸºç¡€ï¼Œè¦ç‰¹åˆ«æ³¨æ„å„ç¬”ç”»çš„èµ·ç¬”ã€è¡Œç¬”ã€æ”¶ç¬”ã€‚æ­¤å­—ç¬”ç”»èˆ’å±•ï¼Œç»“æ„åŒ€ç§°ï¼Œæ˜¯ç»ƒä¹ åŸºæœ¬ç¬”æ³•çš„æœ€ä½³èŒƒæœ¬ã€‚ä¸´æ‘¹æ—¶è¦æ³¨æ„æ•´ä½“å¸ƒå±€ï¼Œä¿æŒå­—çš„é‡å¿ƒç¨³å®šã€‚",
    // æ•´ä½“ä¸´æ‘¹å»ºè®®
    // è¯´æ˜ï¼šé’ˆå¯¹æ•´ä¸ªå­—çš„ç»¼åˆå»ºè®®
    // å†…å®¹ï¼šæ•´ä½“å¸ƒå±€ã€ç»“æ„ç‰¹ç‚¹ã€ä¹¦å†™é¡ºåºã€å¸¸è§é—®é¢˜ç­‰

    "metadata": {
    // å…ƒæ•°æ®ä¿¡æ¯ï¼ˆè°ƒè¯•å’Œè¿½æº¯ç”¨ï¼‰
      "image_size": "800x800",
      // åˆ†ææ—¶ä½¿ç”¨çš„å›¾ç‰‡å°ºå¯¸

      "analysis_time": "2025-12-03 10:00:00",
      // åˆ†ææ—¶é—´

      "model": "doubao-1.5-vision-pro-32k-250115"
      // ä½¿ç”¨çš„AIæ¨¡å‹åç§°å’Œç‰ˆæœ¬
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**åæ ‡ç³»ç»Ÿè¯´æ˜**:

```
å›¾ç‰‡åæ ‡ç³»ç»Ÿï¼ˆç›¸å¯¹åæ ‡ï¼‰ï¼š

(0,0)           (0. 5,0)           (1,0)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚               â”‚               â”‚
  â”‚               â”‚               â”‚
(0,0. 5)       (0.5,0.5)       (1,0.5)  â† å›¾ç‰‡ä¸­å¿ƒ
  â”‚               â”‚               â”‚
  â”‚               â”‚               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(0,1)           (0.5,1)           (1,1)

ç¤ºä¾‹ï¼š
- (0.5, 0.5) = å›¾ç‰‡æ­£ä¸­å¿ƒ
- (0.2, 0.3) = è·ç¦»å·¦è¾¹20%ã€è·ç¦»é¡¶éƒ¨30%
- (0.8, 0.7) = è·ç¦»å·¦è¾¹80%ã€è·ç¦»é¡¶éƒ¨70%

å‰ç«¯è½¬æ¢ä¸ºåƒç´ åæ ‡ï¼š
pixel_x = x * image_width
pixel_y = y * image_height

ç¤ºä¾‹ï¼ˆ800x800å›¾ç‰‡ï¼‰ï¼š
- (0. 5, 0.3) â†’ (400px, 240px)
- (0.7, 0.8) â†’ (560px, 640px)
```

**é”™è¯¯å“åº”ï¼ˆå›¾ç‰‡æ ¼å¼é”™è¯¯ï¼‰**:

```json
{
  "code": 400,
  "message": "å›¾ç‰‡æ–‡ä»¶æ— æ•ˆ",
  "error": {
    "type": "ValidationError",
    "details": {
      "field": "image",
      "reason": "å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä¸Šä¼  JPGã€PNG æˆ– WEBP æ ¼å¼"
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**é”™è¯¯å“åº”ï¼ˆAIæœåŠ¡å¼‚å¸¸ï¼‰**:

```json
{
  "code": 500,
  "message": "AIåˆ†æå¤±è´¥",
  "error": {
    "type": "AIServiceError",
    "details": "æœªé…ç½® ARK_API_KEY ç¯å¢ƒå˜é‡ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä»£ç å®ç°è¯´æ˜**:

```python
# routes/calligraphy.py

# æ ¸å¿ƒå‡½æ•°ï¼šanalyze_with_doubao()
# 1. æ¥æ”¶PIL Imageå¯¹è±¡
# 2. è°ƒæ•´å›¾ç‰‡å°ºå¯¸ï¼ˆresize_image_if_neededï¼‰
# 3.  è½¬æ¢ä¸ºbase64ï¼ˆimage_to_base64ï¼‰
# 4. æ„å»ºPromptæç¤ºè¯
# 5. è°ƒç”¨è±†åŒ…API
# 6. è§£æJSONå“åº”
# 7. æ·»åŠ metadata
# 8. è¿”å›ç»“æœ

# å…³é”®é…ç½®ï¼ˆ. envæ–‡ä»¶ï¼‰ï¼š
# ARK_API_KEY="ä½ çš„APIå¯†é’¥"
# ARK_BASE_URL="https://ark.cn-beijing.volces.com/api/v3"
# ARK_VISION_MODEL="doubao-1.5-vision-pro-32k-250115"
```

---

### 5.2 ä¿å­˜è¯»å¸–

**æ¥å£**: `POST /api/annotations`  
**æè¿°**: ä¿å­˜è¯»å¸–æ³¨é‡Šï¼ˆå¯ä»¥æ˜¯AIç”Ÿæˆçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰‹åŠ¨æ·»åŠ çš„ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**:

```json
{
  "character_id": 1,
  // ã€å¿…å¡«ã€‘å•å­—ID
  // è¯´æ˜ï¼šå…³è”åˆ°å…·ä½“çš„å•å­—
  // è·å–æ–¹å¼ï¼šä»ä½œå“è¯¦æƒ…æˆ–å•å­—åˆ—è¡¨è·å–

  "source": "ai",
  // ã€å¿…å¡«ã€‘æ¥æº
  // å¯é€‰å€¼ï¼š
  //   - ai: AIç”Ÿæˆï¼ˆä»AIåˆ†ææ¥å£è·å¾—ï¼‰
  //   - manual: æ‰‹åŠ¨æ·»åŠ ï¼ˆç”¨æˆ·è‡ªå·±æ ‡æ³¨ï¼‰
  // è¯´æ˜ï¼šç”¨äºåŒºåˆ†æ³¨é‡Šæ¥æº

  "keypoints": [
  // ã€å¿…å¡«ã€‘å…³é”®ç‚¹æ•°ç»„
  // æ•°é‡ï¼šè‡³å°‘1ä¸ªï¼Œæœ€å¤š10ä¸ª
    {
      "x": 0.5,
      // ã€å¿…å¡«ã€‘xåæ ‡
      // ç±»å‹ï¼šæµ®ç‚¹æ•°
      // èŒƒå›´ï¼š0-1ä¹‹é—´
      // è¯´æ˜ï¼šç›¸å¯¹åæ ‡

      "y": 0.3,
      // ã€å¿…å¡«ã€‘yåæ ‡
      // ç±»å‹ï¼šæµ®ç‚¹æ•°
      // èŒƒå›´ï¼š0-1ä¹‹é—´

      "description": "æ¨ªç”»èµ·ç¬”å¤„",
      // ã€å¿…å¡«ã€‘ä½ç½®æè¿°
      // ç±»å‹ï¼šå­—ç¬¦ä¸²
      // è§„åˆ™ï¼šæœ€å¤š50å­—
      // ç”¨é€”ï¼šè¯´æ˜è¿™ä¸ªç‚¹æ ‡æ³¨çš„æ˜¯ä»€ä¹ˆä½ç½®

      "tips": "æ³¨æ„è—é”‹èµ·ç¬”"
      // ã€å¿…å¡«ã€‘ä¸´æ‘¹è¦ç‚¹
      // ç±»å‹ï¼šå­—ç¬¦ä¸²
      // è§„åˆ™ï¼šæœ€å¤š200å­—
      // ç”¨é€”ï¼šå…·ä½“çš„ä¹¦å†™æŠ€å·§å’Œæ³¨æ„äº‹é¡¹
    },
    {
      "x": 0.45,
      "y": 0.6,
      "description": "ç«–ç”»ä¸æ¨ªç”»äº¤å‰ç‚¹",
      "tips": "ç¬”ç”»äº¤å‰è¦è‡ªç„¶"
    }
  ],

  "overall_tips": "æ°¸å­—å…«æ³•æ˜¯ä¹¦æ³•åŸºç¡€ï¼Œè¦ç‰¹åˆ«æ³¨æ„å„ç¬”ç”»çš„èµ·ç¬”ã€è¡Œç¬”ã€æ”¶ç¬”",
  // ã€å¯é€‰ã€‘æ•´ä½“ä¸´æ‘¹å»ºè®®
  // ç±»å‹ï¼šå­—ç¬¦ä¸²
  // è§„åˆ™ï¼šæœ€å¤š500å­—
  // ç”¨é€”ï¼šé’ˆå¯¹æ•´ä¸ªå­—çš„ç»¼åˆå»ºè®®

  "is_public": true
  // ã€å¯é€‰ã€‘æ˜¯å¦å…¬å¼€
  // ç±»å‹ï¼šå¸ƒå°”å€¼
  // é»˜è®¤å€¼ï¼štrue
  // è¯´æ˜ï¼š
  //   - true: å…¶ä»–ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è¿™ä¸ªè¯»å¸–
  //   - false: ä»…è‡ªå·±å¯è§
}
```

**ä½¿ç”¨åœºæ™¯**:

1. **AIç”Ÿæˆåä¿å­˜**: è°ƒç”¨AIåˆ†ææ¥å£åï¼Œå°†è¿”å›çš„æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“
2. **æ‰‹åŠ¨æ·»åŠ **: ç”¨æˆ·è‡ªå·±æ ‡æ³¨å…³é”®ç‚¹å’Œè¦ç‚¹
3. **ä¿®æ”¹AIç»“æœ**: åœ¨AIç”Ÿæˆçš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹åä¿å­˜

**å“åº”**:

```json
{
  "code": 201,
  "message": "ä¿å­˜æˆåŠŸ",
  "data": {
    "annotation": {
      "id": 1,
      // è¯»å¸–ID

      "character_id": 1,
      "user_id": 1,
      "source": "ai",
      "keypoints": [ /* åŒè¯·æ±‚ä½“ */ ],
      "overall_tips": "æ°¸å­—å…«æ³•æ˜¯ä¹¦æ³•åŸºç¡€",
      "is_public": true,
      "created_at": "2025-12-03T10:00:00",
      "updated_at": "2025-12-03T10:00:00",

      "character": {
      // å…³è”çš„å•å­—ä¿¡æ¯
        "id": 1,
        "text": "æ°¸",
        "image_url": "/uploads/characters/char_1.jpg",
        "work": {
          "id": 1,
          "title": "å…°äº­åº",
          "style": "è¡Œä¹¦"
        }
      }
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 5.3 è·å–æˆ‘çš„è¯»å¸–åˆ—è¡¨

**æ¥å£**: `GET /api/annotations/my-annotations`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰è¯»å¸–  
**è®¤è¯**: éœ€è¦ Access Token

**æŸ¥è¯¢å‚æ•°**:

- `page`:
  
  - ã€å¯é€‰ã€‘é¡µç 
  - é»˜è®¤å€¼ï¼š1

- `per_page`:
  
  - ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡
  - é»˜è®¤å€¼ï¼š12

- `character_text`:
  
  - ã€å¯é€‰ã€‘æŒ‰å­—åç­›é€‰
  - ç¤ºä¾‹ï¼š`? character_text=æ°¸`

- `source`:
  
  - ã€å¯é€‰ã€‘æŒ‰æ¥æºç­›é€‰
  - å¯é€‰å€¼ï¼šaiã€manual

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /api/annotations/my-annotations?page=1&per_page=12&character_text=æ°¸&source=ai
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,

        "character": {
        // å…³è”çš„å•å­—ä¿¡æ¯
          "id": 1,
          "text": "æ°¸",
          "image_url": "/uploads/characters/char_1.jpg",
          "work_title": "å…°äº­åº",
          "style": "è¡Œä¹¦"
        },

        "keypoints": [
        // å…³é”®ç‚¹æ•°ç»„
          {
            "x": 0.5,
            "y": 0.3,
            "description": "æ¨ªç”»èµ·ç¬”å¤„",
            "tips": "æ³¨æ„è—é”‹èµ·ç¬”"
          }
        ],

        "overall_tips": "æ°¸å­—å…«æ³•æ˜¯ä¹¦æ³•åŸºç¡€",

        "source": "ai",
        // æ¥æºæ ‡è¯†

        "is_public": true,

        "created_at": "2025-12-03T10:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 12,
      "total": 50,
      "total_pages": 5,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 5. 4 è·å–å•ä¸ªè¯»å¸–è¯¦æƒ…

**æ¥å£**: `GET /api/annotations/{annotation_id}`  
**æè¿°**: è·å–è¯»å¸–çš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯**: éœ€è¦ Access Tokenï¼ˆå¦‚æœè¯»å¸–æ˜¯ç§å¯†çš„ï¼‰

**è·¯å¾„å‚æ•°**:

- `annotation_id`: ã€å¿…å¡«ã€‘è¯»å¸–ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "annotation": {
      "id": 1,
      "character_id": 1,
      "user_id": 1,
      "source": "ai",
      "keypoints": [ /* å…³é”®ç‚¹æ•°ç»„ */ ],
      "overall_tips": "æ°¸å­—å…«æ³•æ˜¯ä¹¦æ³•åŸºç¡€",
      "is_public": true,
      "created_at": "2025-12-03T10:00:00",
      "updated_at": "2025-12-03T10:00:00",

      "character": {
        "id": 1,
        "text": "æ°¸",
        "image_url": "/uploads/characters/char_1.jpg",
        "work": {
          "id": 1,
          "title": "å…°äº­åº",
          "style": "è¡Œä¹¦",
          "dynasty": "ä¸œæ™‹",
          "author_name": "ç‹ç¾²ä¹‹"
        }
      },

      "user": {
      // åˆ›å»ºè€…ä¿¡æ¯
        "id": 1,
        "username": "user1",
        "avatar": "avatars/user1.jpg"
      }
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 5. 5 æ›´æ–°è¯»å¸–

**æ¥å£**: `PUT /api/annotations/{annotation_id}`  
**æè¿°**: æ›´æ–°è¯»å¸–å†…å®¹ï¼ˆä»…åˆ›å»ºè€…å¯ä¿®æ”¹ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `annotation_id`: ã€å¿…å¡«ã€‘è¯»å¸–ID

**è¯·æ±‚ä½“**:

```json
{
  "keypoints": [
  // ã€å¯é€‰ã€‘æ–°çš„å…³é”®ç‚¹æ•°ç»„
    {
      "x": 0.5,
      "y": 0.3,
      "description": "æ¨ªç”»èµ·ç¬”å¤„ï¼ˆä¿®æ”¹åï¼‰",
      "tips": "æ³¨æ„è—é”‹èµ·ç¬”ï¼ŒåŠ›åº¦è¦å‡åŒ€"
    }
  ],

  "overall_tips": "æ›´æ–°åçš„æ•´ä½“å»ºè®®",
  // ã€å¯é€‰ã€‘æ–°çš„æ•´ä½“å»ºè®®

  "is_public": false
  // ã€å¯é€‰ã€‘ä¿®æ”¹å…¬å¼€çŠ¶æ€
}
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "annotation": {
      // æ›´æ–°åçš„å®Œæ•´è¯»å¸–ä¿¡æ¯
      "id": 1,
      "updated_at": "2025-12-03T11:00:00"
      // ... 
    }
  },
  "timestamp": "2025-12-03T11:00:00+08:00"
}
```

---

### 5. 6 åˆ é™¤è¯»å¸–

**æ¥å£**: `DELETE /api/annotations/{annotation_id}`  
**æè¿°**: åˆ é™¤è¯»å¸–ï¼ˆä»…åˆ›å»ºè€…å¯åˆ é™¤ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `annotation_id`: ã€å¿…å¡«ã€‘è¯»å¸–ID

**å“åº”**:

```json
{
  "code": 204,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

## 6. ç¤¾åŒº/å¸–å­ç›¸å…³ API

### 6. 1 è·å–å¸–å­åˆ—è¡¨

**æ¥å£**: `GET /api/posts`  
**æè¿°**: è·å–ç¤¾åŒºå¸–å­åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œæ’åº  
**è®¤è¯**: æ— éœ€è®¤è¯

**æŸ¥è¯¢å‚æ•°**:

- `page`:
  
  - ã€å¯é€‰ã€‘é¡µç 
  - é»˜è®¤å€¼ï¼š1

- `per_page`:
  
  - ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡
  - é»˜è®¤å€¼ï¼š10
  - èŒƒå›´ï¼š1-50

- `sort_by`:
  
  - ã€å¯é€‰ã€‘æ’åºæ–¹å¼
  - å¯é€‰å€¼ï¼š
    - created_at: æŒ‰å‘å¸ƒæ—¶é—´æ’åºï¼ˆé»˜è®¤ï¼‰
    - likes_count: æŒ‰ç‚¹èµæ•°æ’åº
    - comments_count: æŒ‰è¯„è®ºæ•°æ’åº
  - é»˜è®¤å€¼ï¼šcreated_at

- `order`:
  
  - ã€å¯é€‰ã€‘æ’åºé¡ºåº
  - å¯é€‰å€¼ï¼šascï¼ˆå‡åºï¼‰ã€descï¼ˆé™åºï¼‰
  - é»˜è®¤å€¼ï¼šdesc

- `category`:
  
  - ã€å¯é€‰ã€‘å¸–å­ç±»åˆ«ç­›é€‰
  - å¯é€‰å€¼ï¼šæŠ€æ³•äº¤æµã€ä½œå“å±•ç¤ºã€å­¦ä¹ å¿ƒå¾—ã€é—®é¢˜æ±‚åŠ©ç­‰
  - ç¤ºä¾‹ï¼š`? category=æŠ€æ³•äº¤æµ`

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /api/posts?page=1&per_page=10&sort_by=likes_count&order=desc&category=æŠ€æ³•äº¤æµ
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,

        "title": "åˆ†äº«æˆ‘çš„ä¸´æ‘¹å¿ƒå¾—",
        // å¸–å­æ ‡é¢˜ï¼Œå¯é€‰å­—æ®µ

        "content": "ä»Šå¤©ä¸´æ‘¹äº†å…°äº­åº.. .",
        // å¸–å­å†…å®¹ï¼Œå¿…å¡«å­—æ®µ
        // æ”¯æŒï¼šçº¯æ–‡æœ¬æˆ–Markdownæ ¼å¼

        "category": "å­¦ä¹ å¿ƒå¾—",
        // å¸–å­ç±»åˆ«
        // å¯é€‰å€¼ï¼šæŠ€æ³•äº¤æµã€ä½œå“å±•ç¤ºã€å­¦ä¹ å¿ƒå¾—ã€é—®é¢˜æ±‚åŠ©ç­‰

        "author": {
        // å‘å¸–äººä¿¡æ¯
          "id": 1,
          "username": "user1",
          "avatar": "avatars/user1.jpg"
        },

        "likes_count": 50,
        // ç‚¹èµæ•°

        "comments_count": 10,
        // è¯„è®ºæ•°ï¼ˆåŒ…å«æ‰€æœ‰å›å¤ï¼‰

        "is_liked": false,
        // å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµï¼ˆéœ€ç™»å½•ï¼Œæœªç™»å½•è¿”å›falseï¼‰

        "created_at": "2025-12-03T10:00:00",
        // å‘å¸ƒæ—¶é—´

        "updated_at": "2025-12-03T10:00:00"
        // æœ€åæ›´æ–°æ—¶é—´
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 10,
      "total": 100,
      "total_pages": 10,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 6.2 è·å–å¸–å­è¯¦æƒ…

**æ¥å£**: `GET /api/posts/{post_id}`  
**æè¿°**: è·å–å•ä¸ªå¸–å­çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯„è®ºåˆ—è¡¨  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `post_id`: ã€å¿…å¡«ã€‘å¸–å­ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "post": {
      "id": 1,
      "title": "åˆ†äº«æˆ‘çš„ä¸´æ‘¹å¿ƒå¾—",
      "content": "ä»Šå¤©ä¸´æ‘¹äº†å…°äº­åºï¼Œæœ‰ä¸€äº›å¿ƒå¾—æƒ³å’Œå¤§å®¶åˆ†äº«.. .",
      "category": "å­¦ä¹ å¿ƒå¾—",

      "author": {
        "id": 1,
        "username": "user1",
        "avatar": "avatars/user1.jpg"
      },

      "likes_count": 50,
      "comments_count": 10,

      "is_liked": false,
      // å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµï¼ˆéœ€ç™»å½•ï¼‰

      "created_at": "2025-12-03T10:00:00",
      "updated_at": "2025-12-03T10:00:00",

      "comments": [
      // è¯„è®ºåˆ—è¡¨ï¼ˆåªè¿”å›é¡¶çº§è¯„è®ºï¼Œå›å¤åµŒå¥—åœ¨å†…éƒ¨ï¼‰
        {
          "id": 1,
          "content": "å†™å¾—å¾ˆå¥½ï¼Œå­¦ä¹ äº†",
          // è¯„è®ºå†…å®¹

          "author": {
            "id": 2,
            "username": "user2",
            "avatar": "avatars/user2.jpg"
          },

          "parent_id": null,
          // çˆ¶è¯„è®ºIDï¼Œnullè¡¨ç¤ºé¡¶çº§è¯„è®º

          "created_at": "2025-12-03T11:00:00",

          "replies": [
          // å›å¤åˆ—è¡¨
            {
              "id": 2,
              "content": "è°¢è°¢æ”¯æŒ",
              "author": {
                "id": 1,
                "username": "user1",
                "avatar": "avatars/user1.jpg"
              },
              "parent_id": 1,
              // å›å¤çš„æ˜¯è¯„è®ºIDä¸º1çš„è¯„è®º

              "created_at": "2025-12-03T11:30:00"
            }
          ]
        }
      ]
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 6. 3 å‘å¸ƒå¸–å­

**æ¥å£**: `POST /api/posts`  
**æè¿°**: åœ¨ç¤¾åŒºå‘å¸ƒæ–°å¸–å­  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**:

```json
{
  "title": "åˆ†äº«æˆ‘çš„ä¸´æ‘¹å¿ƒå¾—",
  // ã€å¯é€‰ã€‘å¸–å­æ ‡é¢˜
  // è§„åˆ™ï¼šæœ€å¤š200ä¸ªå­—ç¬¦
  // è¯´æ˜ï¼šæ ‡é¢˜å¯é€‰ï¼Œä½†å»ºè®®å¡«å†™

  "content": "ä»Šå¤©ä¸´æ‘¹äº†å…°äº­åºï¼Œæœ‰ä¸€äº›å¿ƒå¾—æƒ³å’Œå¤§å®¶åˆ†äº«...",
  // ã€å¿…å¡«ã€‘å¸–å­å†…å®¹
  // è§„åˆ™ï¼šä¸èƒ½ä¸ºç©ºï¼Œæœ€å¤š10000å­—
  // æ”¯æŒï¼šçº¯æ–‡æœ¬æˆ–Markdownæ ¼å¼

  "category": "å­¦ä¹ å¿ƒå¾—"
  // ã€å¯é€‰ã€‘å¸–å­ç±»åˆ«
  // å¯é€‰å€¼ï¼šæŠ€æ³•äº¤æµã€ä½œå“å±•ç¤ºã€å­¦ä¹ å¿ƒå¾—ã€é—®é¢˜æ±‚åŠ©ã€å…¶ä»–
  // é»˜è®¤å€¼ï¼šå…¶ä»–
}
```

**å“åº”**:

```json
{
  "code": 201,
  "message": "å¸–å­å‘å¸ƒæˆåŠŸ",
  "data": {
    "post": {
      "id": 1,
      "title": "åˆ†äº«æˆ‘çš„ä¸´æ‘¹å¿ƒå¾—",
      "content": "ä»Šå¤©ä¸´æ‘¹äº†å…°äº­åº.. .",
      "category": "å­¦ä¹ å¿ƒå¾—",
      "author": {
        "id": 1,
        "username": "user1",
        "avatar": "avatars/user1.jpg"
      },
      "likes_count": 0,
      "comments_count": 0,
      "created_at": "2025-12-03T10:00:00",
      "updated_at": "2025-12-03T10:00:00"
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 6.4 æ›´æ–°å¸–å­

**æ¥å£**: `PUT /api/posts/{post_id}`  
**æè¿°**: æ›´æ–°å¸–å­å†…å®¹ï¼ˆä»…ä½œè€…å¯ä¿®æ”¹ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `post_id`: ã€å¿…å¡«ã€‘å¸–å­ID

**è¯·æ±‚ä½“**:

```json
{
  "title": "ä¿®æ”¹åçš„æ ‡é¢˜",
  // ã€å¯é€‰ã€‘æ–°æ ‡é¢˜

  "content": "ä¿®æ”¹åçš„å†…å®¹",
  // ã€å¯é€‰ã€‘æ–°å†…å®¹

  "category": "æŠ€æ³•äº¤æµ"
  // ã€å¯é€‰ã€‘æ–°ç±»åˆ«
}
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ",
  "data": {
    "post": {
      // æ›´æ–°åçš„å®Œæ•´å¸–å­ä¿¡æ¯
      "id": 1,
      "title": "ä¿®æ”¹åçš„æ ‡é¢˜",
      "updated_at": "2025-12-03T11:00:00"
      // ...
    }
  },
  "timestamp": "2025-12-03T11:00:00+08:00"
}
```

---

### 6.5 åˆ é™¤å¸–å­

**æ¥å£**: `DELETE /api/posts/{post_id}`  
**æè¿°**: åˆ é™¤å¸–å­ï¼ˆä»…ä½œè€…å¯åˆ é™¤ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `post_id`: ã€å¿…å¡«ã€‘å¸–å­ID

**å“åº”**:

```json
{
  "code": 204,
  "message": "å¸–å­å·²åˆ é™¤",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**çº§è”åˆ é™¤**:

- è¯¥å¸–å­çš„æ‰€æœ‰è¯„è®º
- è¯¥å¸–å­çš„æ‰€æœ‰ç‚¹èµè®°å½•
- ç›¸å…³çš„é€šçŸ¥è®°å½•

---

### 6.6 ç‚¹èµå¸–å­

**æ¥å£**: `POST /api/posts/{post_id}/like`  
**æè¿°**: ç»™å¸–å­ç‚¹èµï¼ˆé‡å¤ç‚¹èµä¼šè‡ªåŠ¨å–æ¶ˆï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `post_id`: ã€å¿…å¡«ã€‘å¸–å­ID

**å“åº”ï¼ˆç‚¹èµæˆåŠŸï¼‰**:

```json
{
  "code": 201,
  "message": "ç‚¹èµæˆåŠŸ",
  "data": {
    "is_liked": true,
    // å½“å‰ç‚¹èµçŠ¶æ€

    "likes_count": 51
    // æ›´æ–°åçš„ç‚¹èµæ•°
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**å“åº”ï¼ˆå–æ¶ˆç‚¹èµï¼‰**:

```json
{
  "code": 200,
  "message": "å·²å–æ¶ˆç‚¹èµ",
  "data": {
    "is_liked": false,
    "likes_count": 50
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

- å¦‚æœæœªç‚¹èµï¼Œåˆ™æ·»åŠ ç‚¹èµ
- å¦‚æœå·²ç‚¹èµï¼Œåˆ™å–æ¶ˆç‚¹èµï¼ˆtoggleæ¨¡å¼ï¼‰

---

### 6.7 è¯„è®ºå¸–å­

**æ¥å£**: `POST /api/posts/{post_id}/comments`  
**æè¿°**: å¯¹å¸–å­å‘è¡¨è¯„è®ºæˆ–å›å¤  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `post_id`: ã€å¿…å¡«ã€‘å¸–å­ID

**è¯·æ±‚ä½“**:

```json
{
  "content": "å†™å¾—å¾ˆå¥½ï¼Œå­¦ä¹ äº†",
  // ã€å¿…å¡«ã€‘è¯„è®ºå†…å®¹
  // è§„åˆ™ï¼šä¸èƒ½ä¸ºç©ºï¼Œæœ€å¤š1000å­—

  "parent_id": null
  // ã€å¯é€‰ã€‘çˆ¶è¯„è®ºID
  // è¯´æ˜ï¼š
  //   - null æˆ–ä¸ä¼ ï¼šå‘è¡¨é¡¶çº§è¯„è®º
  //   - ä¼ å…·ä½“IDï¼šå›å¤æŸæ¡è¯„è®º
}
```

**å“åº”**:

```json
{
  "code": 201,
  "message": "è¯„è®ºæˆåŠŸ",
  "data": {
    "comment": {
      "id": 1,
      "content": "å†™å¾—å¾ˆå¥½ï¼Œå­¦ä¹ äº†",
      "post_id": 1,
      "author": {
        "id": 2,
        "username": "user2",
        "avatar": "avatars/user2.jpg"
      },
      "parent_id": null,
      "created_at": "2025-12-03T11:00:00"
    }
  },
  "timestamp": "2025-12-03T11:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

1. åˆ›å»ºè¯„è®ºè®°å½•
2. æ›´æ–°å¸–å­çš„comments_count
3. åˆ›å»ºé€šçŸ¥ï¼ˆé€šçŸ¥å¸–å­ä½œè€…æˆ–è¢«å›å¤è€…ï¼‰

---

### 6.8 åˆ é™¤è¯„è®º

**æ¥å£**: `DELETE /api/comments/{comment_id}`  
**æè¿°**: åˆ é™¤è¯„è®ºï¼ˆä»…è¯„è®ºè€…å¯åˆ é™¤ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `comment_id`: ã€å¿…å¡«ã€‘è¯„è®ºID

**å“åº”**:

```json
{
  "code": 200,
  "message": "è¯„è®ºå·²åˆ é™¤",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**æ³¨æ„**: åˆ é™¤é¡¶çº§è¯„è®ºä¼šçº§è”åˆ é™¤æ‰€æœ‰å›å¤

---

## 7. æ”¶è—ç›¸å…³ API

### 7. 1 è·å–æˆ‘çš„æ”¶è—åˆ—è¡¨

**æ¥å£**: `GET /api/collections`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·æ”¶è—çš„ä½œå“åˆ—è¡¨  
**è®¤è¯**: éœ€è¦ Access Token

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼12

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        // æ”¶è—è®°å½•ID

        "work": {
        // ä½œå“ä¿¡æ¯
          "id": 1,
          "title": "å…°äº­åº",
          "image_url": "/uploads/works/lantingxu.jpg",
          "style": "è¡Œä¹¦",
          "dynasty": "ä¸œæ™‹",
          "author_name": "ç‹ç¾²ä¹‹",
          "likes_count": 100,
          "views": 1000,
          "author": {
          // ä¸Šä¼ è€…ä¿¡æ¯
            "id": 1,
            "username": "admin",
            "avatar": "avatars/admin.jpg"
          }
        },

        "created_at": "2025-12-03T10:00:00"
        // æ”¶è—æ—¶é—´
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 12,
      "total": 50,
      "total_pages": 5,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 7.2 æ·»åŠ æ”¶è—

**æ¥å£**: `POST /api/collections`  
**æè¿°**: æ”¶è—ä½œå“  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**:

```json
{
  "work_id": 1
  // ã€å¿…å¡«ã€‘ä½œå“ID
}
```

**å“åº”**:

```json
{
  "code": 201,
  "message": "æ”¶è—æˆåŠŸ",
  "data": {
    "collection": {
      "id": 1,
      "user_id": 1,
      "work_id": 1,
      "created_at": "2025-12-03T10:00:00"
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**é”™è¯¯å“åº”ï¼ˆå·²æ”¶è—ï¼‰**:

```json
{
  "code": 409,
  "message": "å·²ç»æ”¶è—è¿‡äº†",
  "error": {
    "type": "DuplicateError",
    "details": null
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 7.3 å–æ¶ˆæ”¶è—

**æ¥å£**: `DELETE /api/collections/{work_id}`  
**æè¿°**: å–æ¶ˆæ”¶è—ä½œå“  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "å–æ¶ˆæ”¶è—æˆåŠŸ",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 7.4 æ£€æŸ¥æ˜¯å¦å·²æ”¶è—

**æ¥å£**: `GET /api/collections/check/{work_id}`  
**æè¿°**: æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²æ”¶è—æŸä½œå“  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "is_collected": true
    // true: å·²æ”¶è—
    // false: æœªæ”¶è—
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

## 8. è¯„è®ºç›¸å…³ API

### 8.1 åˆ›å»ºè¯„è®ºï¼ˆé’ˆå¯¹ä½œå“ï¼‰

**æ¥å£**: `POST /api/comments`  
**æè¿°**: å¯¹ä½œå“å‘è¡¨è¯„è®º  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**:

```json
{
  "work_id": 1,
  // ã€å¿…å¡«ã€‘ä½œå“ID

  "content": "è¿™å¹…ä½œå“å¤ªæ£’äº†",
  // ã€å¿…å¡«ã€‘è¯„è®ºå†…å®¹
  // è§„åˆ™ï¼šä¸èƒ½ä¸ºç©ºï¼Œæœ€å¤š1000å­—

  "parent_id": null
  // ã€å¯é€‰ã€‘çˆ¶è¯„è®ºID
  // null: å‘è¡¨é¡¶çº§è¯„è®º
  // å…·ä½“ID: å›å¤æŸæ¡è¯„è®º
}
```

**å“åº”**:

```json
{
  "code": 201,
  "message": "è¯„è®ºæˆåŠŸ",
  "data": {
    "comment": {
      "id": 1,
      "content": "è¿™å¹…ä½œå“å¤ªæ£’äº†",
      "work_id": 1,
      "author": {
        "id": 2,
        "username": "user2",
        "avatar": "avatars/user2. jpg"
      },
      "parent_id": null,
      "created_at": "2025-12-03T11:00:00",
      "updated_at": "2025-12-03T11:00:00"
    }
  },
  "timestamp": "2025-12-03T11:00:00+08:00"
}
```

---

### 8.2 è·å–ä½œå“è¯„è®ºåˆ—è¡¨

**æ¥å£**: `GET /api/comments/work/{work_id}`  
**æè¿°**: è·å–ä½œå“çš„è¯„è®ºåˆ—è¡¨  
**è®¤è¯**: æ— éœ€è®¤è¯

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "content": "è¿™å¹…ä½œå“å¤ªæ£’äº†",
        "work_id": 1,
        "author": {
          "id": 2,
          "username": "user2",
          "avatar": "avatars/user2.jpg"
        },
        "parent_id": null,
        "created_at": "2025-12-03T11:00:00",
        "updated_at": "2025-12-03T11:00:00",

        "replies": [
        // å›å¤åˆ—è¡¨
          {
            "id": 2,
            "content": "è°¢è°¢",
            "author": {
              "id": 1,
              "username": "user1",
              "avatar": "avatars/user1.jpg"
            },
            "parent_id": 1,
            "created_at": "2025-12-03T11:30:00"
          }
        ],

        "replies_count": 1
        // å›å¤æ•°é‡
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 50,
      "total_pages": 3,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 8.3 æ›´æ–°è¯„è®º

**æ¥å£**: `PUT /api/comments/{comment_id}`  
**æè¿°**: æ›´æ–°è¯„è®ºå†…å®¹ï¼ˆä»…è¯„è®ºè€…å¯ä¿®æ”¹ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `comment_id`: ã€å¿…å¡«ã€‘è¯„è®ºID

**è¯·æ±‚ä½“**:

```json
{
  "content": "ä¿®æ”¹åçš„è¯„è®ºå†…å®¹"
  // ã€å¿…å¡«ã€‘æ–°çš„è¯„è®ºå†…å®¹
}
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "è¯„è®ºæ›´æ–°æˆåŠŸ",
  "data": {
    "comment": {
      "id": 1,
      "content": "ä¿®æ”¹åçš„è¯„è®ºå†…å®¹",
      "updated_at": "2025-12-03T12:00:00"
      // ... 
    }
  },
  "timestamp": "2025-12-03T12:00:00+08:00"
}
```

---

### 8. 4 åˆ é™¤è¯„è®º

**æ¥å£**: `DELETE /api/comments/{comment_id}`  
**æè¿°**: åˆ é™¤è¯„è®ºï¼ˆä»…è¯„è®ºè€…å¯åˆ é™¤ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `comment_id`: ã€å¿…å¡«ã€‘è¯„è®ºID

**å“åº”**:

```json
{
  "code": 200,
  "message": "è¯„è®ºå·²åˆ é™¤",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

## 9. æ¶ˆæ¯é€šçŸ¥ API

### 9.1 è·å–æ¶ˆæ¯é€šçŸ¥åˆ—è¡¨

**æ¥å£**: `GET /api/notifications`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„é€šçŸ¥åˆ—è¡¨  
**è®¤è¯**: éœ€è¦ Access Token

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20
- `is_read`: ã€å¯é€‰ã€‘ç­›é€‰å·²è¯»/æœªè¯»ï¼Œtrue/false
- `type`: ã€å¯é€‰ã€‘é€šçŸ¥ç±»å‹ç­›é€‰ï¼Œlike/comment/follow/system

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,

        "type": "like",
        // é€šçŸ¥ç±»å‹
        // å¯é€‰å€¼ï¼š
        //   - like: ç‚¹èµé€šçŸ¥
        //   - comment: è¯„è®ºé€šçŸ¥
        //   - follow: å…³æ³¨é€šçŸ¥
        //   - system: ç³»ç»Ÿé€šçŸ¥

        "content": "user1 ç‚¹èµäº†ä½ çš„ä½œå“ã€Šå…°äº­åºã€‹",
        // é€šçŸ¥å†…å®¹æè¿°

        "sender": {
        // å‘é€è€…ä¿¡æ¯ï¼ˆsystemç±»å‹æ— æ­¤å­—æ®µï¼‰
          "id": 1,
          "username": "user1",
          "avatar": "avatars/user1.jpg"
        },

        "related_type": "work",
        // å…³è”å¯¹è±¡ç±»å‹
        // å¯é€‰å€¼ï¼šworkï¼ˆä½œå“ï¼‰ã€postï¼ˆå¸–å­ï¼‰ã€commentï¼ˆè¯„è®ºï¼‰

        "related_id": 1,
        // å…³è”å¯¹è±¡ID
        // è¯´æ˜ï¼šå¯ä»¥æ ¹æ®related_typeå’Œrelated_idè·³è½¬åˆ°å¯¹åº”é¡µé¢

        "is_read": false,
        // æ˜¯å¦å·²è¯»

        "created_at": "2025-12-03T10:00:00"
        // é€šçŸ¥æ—¶é—´
      },
      {
        "id": 2,
        "type": "comment",
        "content": "user2 è¯„è®ºäº†ä½ çš„å¸–å­ã€Šåˆ†äº«ä¸´æ‘¹å¿ƒå¾—ã€‹",
        "sender": {
          "id": 2,
          "username": "user2",
          "avatar": "avatars/user2.jpg"
        },
        "related_type": "post",
        "related_id": 5,
        "is_read": true,
        "created_at": "2025-12-03T09:00:00"
      }
    ],

    "unread_count": 5,
    // æœªè¯»é€šçŸ¥æ€»æ•°

    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 50,
      "total_pages": 3,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 9.2 æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»

**æ¥å£**: `PUT /api/notifications/{notification_id}/read`  
**æè¿°**: æ ‡è®°å•ä¸ªé€šçŸ¥ä¸ºå·²è¯»  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `notification_id`: ã€å¿…å¡«ã€‘é€šçŸ¥ID

**å“åº”**:

```json
{
  "code": 200,
  "message": "æ ‡è®°æˆåŠŸ",
  "data": {
    "notification": {
      "id": 1,
      "is_read": true
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 9.3 æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»

**æ¥å£**: `PUT /api/notifications/read-all`  
**æè¿°**: æ ‡è®°æ‰€æœ‰æœªè¯»é€šçŸ¥ä¸ºå·²è¯»  
**è®¤è¯**: éœ€è¦ Access Token

**å“åº”**:

```json
{
  "code": 200,
  "message": "å…¨éƒ¨æ ‡è®°æˆåŠŸ",
  "data": {
    "updated_count": 5
    // æ›´æ–°çš„é€šçŸ¥æ•°é‡
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 9.4 åˆ é™¤é€šçŸ¥

**æ¥å£**: `DELETE /api/notifications/{notification_id}`  
**æè¿°**: åˆ é™¤å•ä¸ªé€šçŸ¥  
**è®¤è¯**: éœ€è¦ Access Token

**è·¯å¾„å‚æ•°**:

- `notification_id`: ã€å¿…å¡«ã€‘é€šçŸ¥ID

**å“åº”**:

```json
{
  "code": 204,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null,
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

## 10. æ¯æ—¥æ‰“å¡ API

### 10.1 æ¯æ—¥æ‰“å¡

**æ¥å£**: `POST /api/checkin`  
**æè¿°**: ç”¨æˆ·æ¯æ—¥æ‰“å¡  
**è®¤è¯**: éœ€è¦ Access Token

**è¯·æ±‚ä½“**: æ— éœ€è¯·æ±‚ä½“

**å“åº”**:

```json
{
  "code": 201,
  "message": "æ‰“å¡æˆåŠŸ",
  "data": {
    "checkin": {
      "id": 1,
      "user_id": 1,
      "checkin_date": "2025-12-03",
      // æ‰“å¡æ—¥æœŸ

      "created_at": "2025-12-03T10:00:00"
      // æ‰“å¡æ—¶é—´
    },

    "consecutive_days": 7,
    // è¿ç»­æ‰“å¡å¤©æ•°
    // è¯´æ˜ï¼šä¸­æ–­åä»1é‡æ–°å¼€å§‹

    "total_checkins": 30
    // ç´¯è®¡æ‰“å¡å¤©æ•°
    // è¯´æ˜ï¼šå†å²æ€»æ‰“å¡æ¬¡æ•°
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**é”™è¯¯å“åº”ï¼ˆä»Šæ—¥å·²æ‰“å¡ï¼‰**:

```json
{
  "code": 409,
  "message": "ä»Šå¤©å·²ç»æ‰“å¡è¿‡äº†",
  "error": {
    "type": "DuplicateError",
    "details": null
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

1. æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²æ‰“å¡
2. åˆ›å»ºæ‰“å¡è®°å½•
3. è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°
4. è®¡ç®—ç´¯è®¡æ‰“å¡å¤©æ•°
5. ï¼ˆå¯é€‰ï¼‰å‘æ”¾æ‰“å¡å¥–åŠ±

---

### 10.2 è·å–æ‰“å¡çŠ¶æ€

**æ¥å£**: `GET /api/checkin/status`  
**æè¿°**: è·å–ç”¨æˆ·çš„æ‰“å¡çŠ¶æ€ä¿¡æ¯  
**è®¤è¯**: éœ€è¦ Access Token

**å“åº”**:

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "has_checked_in_today": true,
    // ä»Šå¤©æ˜¯å¦å·²æ‰“å¡

    "consecutive_days": 7,
    // è¿ç»­æ‰“å¡å¤©æ•°

    "total_checkins": 30,
    // ç´¯è®¡æ‰“å¡å¤©æ•°

    "today": "2025-12-03",
    // ä»Šå¤©çš„æ—¥æœŸ

    "month_checkins": [
    // æœ¬æœˆæ‰“å¡æ—¥æœŸåˆ—è¡¨ï¼ˆç”¨äºæ—¥å†å±•ç¤ºï¼‰
      "2025-12-01",
      "2025-12-02",
      "2025-12-03"
    ]
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 10.3 è·å–æ‰“å¡å†å²

**æ¥å£**: `GET /api/checkin/history`  
**æè¿°**: è·å–ç”¨æˆ·çš„æ‰“å¡å†å²è®°å½•  
**è®¤è¯**: éœ€è¦ Access Token

**æŸ¥è¯¢å‚æ•°**:

- `year`: ã€å¯é€‰ã€‘å¹´ä»½ï¼Œé»˜è®¤å½“å‰å¹´
- `month`: ã€å¯é€‰ã€‘æœˆä»½ï¼ˆ1-12ï¼‰ï¼Œé»˜è®¤å½“å‰æœˆ

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /api/checkin/history?year=2025&month=12
```

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "year": 2025,
    "month": 12,
    "checkins": [
      {
        "id": 1,
        "checkin_date": "2025-12-01",
        "created_at": "2025-12-01T08:30:00"
      },
      {
        "id": 2,
        "checkin_date": "2025-12-02",
        "created_at": "2025-12-02T09:15:00"
      }
    ],
    "total_days": 2
    // æœ¬æœˆæ‰“å¡å¤©æ•°
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

## 11. å®¡æ ¸ä¸­å¿ƒ API

### 11.1 è·å–å¾…å®¡æ ¸ä½œå“åˆ—è¡¨

**æ¥å£**: `GET /api/review/pending`  
**æè¿°**: è·å–æ‰€æœ‰å¾…å®¡æ ¸çš„ä½œå“ï¼ˆä»…ç®¡ç†å‘˜ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token + ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "å…°äº­åº",
        "description": "å¤©ä¸‹ç¬¬ä¸€è¡Œä¹¦",
        "image_url": "/uploads/works/work_1.jpg",
        "style": "è¡Œä¹¦",
        "dynasty": "ä¸œæ™‹",
        "author_name": "ç‹ç¾²ä¹‹",
        "character_count": 324,

        "status": "pending",
        // å®¡æ ¸çŠ¶æ€

        "author": {
        // ä¸Šä¼ è€…ä¿¡æ¯
          "id": 1,
          "username": "user1",
          "avatar": "avatars/user1.jpg",
          "email": "user1@example.com"
        },

        "created_at": "2025-12-03T10:00:00"
        // æäº¤æ—¶é—´
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 10,
      "total_pages": 1,
      "has_next": false,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

### 11.2 å®¡æ ¸ä½œå“

**æ¥å£**: `POST /api/review/{work_id}`  
**æè¿°**: å®¡æ ¸ä½œå“ï¼ˆé€šè¿‡æˆ–æ‹’ç»ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token + ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:

- `work_id`: ã€å¿…å¡«ã€‘ä½œå“ID

**è¯·æ±‚ä½“**:

```json
{
  "status": "approved",
  // ã€å¿…å¡«ã€‘å®¡æ ¸ç»“æœ
  // å¯é€‰å€¼ï¼š
  //   - approved: é€šè¿‡
  //   - rejected: æ‹’ç»

  "reason": "å›¾ç‰‡ä¸æ¸…æ™°ï¼Œè¯·é‡æ–°ä¸Šä¼ "
  // ã€å¯é€‰ã€‘æ‹’ç»åŸå› 
  // è¯´æ˜ï¼šå½“statusä¸ºrejectedæ—¶ï¼Œå»ºè®®å¡«å†™
  // è§„åˆ™ï¼šæœ€å¤š500å­—
}
```

**å“åº”ï¼ˆå®¡æ ¸é€šè¿‡ï¼‰**:

```json
{
  "code": 200,
  "message": "å®¡æ ¸æˆåŠŸ",
  "data": {
    "work": {
      "id": 1,
      "title": "å…°äº­åº",
      "status": "approved",
      "reject_reason": null
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**å“åº”ï¼ˆå®¡æ ¸æ‹’ç»ï¼‰**:

```json
{
  "code": 200,
  "message": "å®¡æ ¸æˆåŠŸ",
  "data": {
    "work": {
      "id": 1,
      "title": "å…°äº­åº",
      "status": "rejected",
      "reject_reason": "å›¾ç‰‡ä¸æ¸…æ™°ï¼Œè¯·é‡æ–°ä¸Šä¼ "
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:

1. æ£€æŸ¥ç®¡ç†å‘˜æƒé™
2. æ›´æ–°ä½œå“çŠ¶æ€
3. å¦‚æœæ‹’ç»ï¼Œä¿å­˜æ‹’ç»åŸå› 
4. åˆ›å»ºé€šçŸ¥ï¼ˆé€šçŸ¥ä½œå“ä¸Šä¼ è€…ï¼‰
5. å¦‚æœé€šè¿‡ï¼Œä½œå“å°†åœ¨åˆ—è¡¨ä¸­å±•ç¤º

---

### 11. 3 è·å–å®¡æ ¸å†å²

**æ¥å£**: `GET /api/review/history`  
**æè¿°**: è·å–å®¡æ ¸å†å²è®°å½•ï¼ˆä»…ç®¡ç†å‘˜ï¼‰  
**è®¤è¯**: éœ€è¦ Access Token + ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:

- `page`: ã€å¯é€‰ã€‘é¡µç ï¼Œé»˜è®¤å€¼1
- `per_page`: ã€å¯é€‰ã€‘æ¯é¡µæ•°é‡ï¼Œé»˜è®¤å€¼20
- `status`: ã€å¯é€‰ã€‘ç­›é€‰çŠ¶æ€ï¼Œapproved/rejected

**å“åº”**:

```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "å…°äº­åº",
        "status": "approved",
        "reject_reason": null,
        "author": {
          "id": 1,
          "username": "user1"
        },
        "created_at": "2025-12-03T10:00:00",
        "reviewed_at": "2025-12-03T11:00:00"
        // å®¡æ ¸æ—¶é—´
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 100,
      "total_pages": 5,
      "has_next": true,
      "has_prev": false
    }
  },
  "timestamp": "2025-12-03T10:00:00+08:00"
}
```

---

## æ•°æ®æ¨¡å‹

### ç”¨æˆ·ä¿¡æ¯ (User)

```json
{
  "id": "integer",              // ç”¨æˆ·IDï¼Œä¸»é”®
  "username": "string",         // ç”¨æˆ·åï¼Œå”¯ä¸€
  "email": "string",            // é‚®ç®±ï¼Œå”¯ä¸€
  "password_hash": "string",    // å¯†ç å“ˆå¸Œå€¼
  "phone": "string",            // æ‰‹æœºå·ï¼Œå”¯ä¸€
  "avatar": "string",           // å¤´åƒURL
  "bio": "text",                // ä¸ªäººç®€ä»‹
  "gender": "string",           // æ€§åˆ«ï¼šmale/female/other
  "birthdate": "date",          // å‡ºç”Ÿæ—¥æœŸ
  "is_active": "boolean",       // è´¦å·æ˜¯å¦æ¿€æ´»
  "is_admin": "boolean",        // æ˜¯å¦ä¸ºç®¡ç†å‘˜
  "created_at": "datetime",     // åˆ›å»ºæ—¶é—´
  "updated_at": "datetime"      // æ›´æ–°æ—¶é—´
}
```

### ä½œå“ä¿¡æ¯ (Work)

```json
{
  "id": "integer",              // ä½œå“ID
  "title": "string",            // ä½œå“åç§°
  "description": "text",        // ä½œå“æè¿°
  "image_url": "string",        // å›¾ç‰‡URL
  "style": "string",            // ä¹¦æ³•é£æ ¼
  "dynasty": "string",          // æœä»£
  "author_name": "string",      // åŸä½œè€…å
  "author_id": "integer",       // ä¸Šä¼ è€…IDï¼ˆå¤–é”®ï¼‰
  "character_count": "integer", // å•å­—æ•°é‡
  "views": "integer",           // æµè§ˆé‡
  "status": "string",           // å®¡æ ¸çŠ¶æ€ï¼špending/approved/rejected
  "reject_reason": "text",      // æ‹’ç»åŸå› 
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

### å•å­—ä¿¡æ¯ (Character)

```json
{
  "id": "integer",              // å•å­—ID
  "text": "string",             // å•å­—å†…å®¹
  "work_id": "integer",         // æ‰€å±ä½œå“IDï¼ˆå¤–é”®ï¼‰
  "position": "json",           // ä½ç½®åæ ‡ [x1,y1,x2,y2]
  "stroke_count": "integer",    // ç¬”ç”»æ•°
  "stroke_order": "text",       // ç¬”é¡ºæè¿°
  "image_url": "string",        // å•å­—æˆªå›¾URL
  "ocr_confidence": "float",    // OCRç½®ä¿¡åº¦
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

### è¯»å¸–ä¿¡æ¯ (Annotation)

```json
{
  "id": "integer",              // è¯»å¸–ID
  "character_id": "integer",    // å•å­—IDï¼ˆå¤–é”®ï¼‰
  "user_id": "integer",         // ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
  "source": "string",           // æ¥æºï¼šai/manual
  "keypoints": "json",          // å…³é”®ç‚¹æ•°ç»„
  "overall_tips": "text",       // æ•´ä½“å»ºè®®
  "is_public": "boolean",       // æ˜¯å¦å…¬å¼€
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

### å¸–å­ä¿¡æ¯ (Post)

```json
{
  "id": "integer",              // å¸–å­ID
  "title": "string",            // æ ‡é¢˜
  "content": "text",            // å†…å®¹
  "category": "string",         // ç±»åˆ«
  "author_id": "integer",       // ä½œè€…IDï¼ˆå¤–é”®ï¼‰
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

### å…³æ³¨å…³ç³» (Follow)

```json
{
  "id": "integer",              // å…³æ³¨ID
  "follower_id": "integer",     // å…³æ³¨è€…IDï¼ˆå¤–é”®ï¼‰
  "following_id": "integer",    // è¢«å…³æ³¨è€…IDï¼ˆå¤–é”®ï¼‰
  "created_at": "datetime"
}
```

### é€šçŸ¥ä¿¡æ¯ (Notification)

```json
{
  "id": "integer",              // é€šçŸ¥ID
  "recipient_id": "integer",    // æ¥æ”¶è€…IDï¼ˆå¤–é”®ï¼‰
  "sender_id": "integer",       // å‘é€è€…IDï¼ˆå¤–é”®ï¼‰
  "type": "string",             // ç±»å‹ï¼šlike/comment/follow/system
  "content": "text",            // é€šçŸ¥å†…å®¹
  "related_type": "string",     // å…³è”ç±»å‹ï¼šwork/post/comment
  "related_id": "integer",      // å…³è”å¯¹è±¡ID
  "is_read": "boolean",         // æ˜¯å¦å·²è¯»
  "created_at": "datetime"
}
```

### æ‰“å¡ä¿¡æ¯ (Checkin)

```json
{
  "id": "integer",              // æ‰“å¡ID
  "user_id": "integer",         // ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
  "checkin_date": "date",       // æ‰“å¡æ—¥æœŸ
  "created_at": "datetime"      // æ‰“å¡æ—¶é—´
}
```

---

## é”™è¯¯ç è¯´æ˜

### å¸¸è§é”™è¯¯ç±»å‹

| é”™è¯¯ç±»å‹                | HTTPçŠ¶æ€ç  | è¯´æ˜      | ç¤ºä¾‹         |
| ------------------- | ------- | ------- | ---------- |
| ValidationError     | 400     | å‚æ•°éªŒè¯å¤±è´¥  | ç”¨æˆ·åæ ¼å¼é”™è¯¯    |
| AuthenticationError | 401     | è®¤è¯å¤±è´¥    | Tokenæ— æ•ˆ    |
| PermissionError     | 403     | æƒé™ä¸è¶³    | éç®¡ç†å‘˜è®¿é—®ç®¡ç†æ¥å£ |
| NotFoundError       | 404     | èµ„æºä¸å­˜åœ¨   | ä½œå“IDä¸å­˜åœ¨    |
| DuplicateError      | 409     | èµ„æºå†²çª    | é‡å¤æ”¶è—       |
| ServerError         | 500     | æœåŠ¡å™¨é”™è¯¯   | æ•°æ®åº“è¿æ¥å¤±è´¥    |
| ExternalAPIError    | 502     | å¤–éƒ¨APIé”™è¯¯ | OCRæœåŠ¡è°ƒç”¨å¤±è´¥  |
| AIServiceError      | 500     | AIæœåŠ¡é”™è¯¯  | AIåˆ†æå¤±è´¥     |

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡é…ç½®

```bash
# . env æ–‡ä»¶ç¤ºä¾‹

# Flaské…ç½®
FLASK_APP=app.py
FLASK_ENV=development
SECRET_KEY=your-secret-key-here
JWT_SECRET_KEY=your-jwt-secret-key-here

# æ•°æ®åº“é…ç½®
DATABASE_URI=sqlite:///icalligraphy.db

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_FOLDER=uploads
MAX_CONTENT_LENGTH=16777216

# å¤ç±OCR APIé…ç½®
Token="your-ocr-token"
Email="your-email"

# è±†åŒ…å¤§æ¨¡å‹ API é…ç½®
ARK_API_KEY="your-api-key"
ARK_BASE_URL="https://ark.cn-beijing.volces.com/api/v3"
ARK_VISION_MODEL="doubao-1.5-vision-pro-32k-250115"
```

### B. è¯·æ±‚ç¤ºä¾‹ï¼ˆPythonï¼‰

```python
import requests

# 1. ç”¨æˆ·æ³¨å†Œ
response = requests.post(
    'http://localhost:5000/api/auth/register',
    json={
        'username': 'testuser',
        'email': 'test@example.com',
        'password': 'password123'
    }
)
data = response.json()
access_token = data['data']['access_token']

# 2. è·å–ä½œå“åˆ—è¡¨
response = requests.get(
    'http://localhost:5000/api/works',
    params={'page': 1, 'per_page': 12}
)

# 3. ä¸Šä¼ ä½œå“ï¼ˆéœ€è¦è®¤è¯ï¼‰
headers = {'Authorization': f'Bearer {access_token}'}
files = {'image': open('lantingxu.jpg', 'rb')}
data = {
    'title': 'å…°äº­åº',
    'style': 'è¡Œä¹¦'
}
response = requests.post(
    'http://localhost:5000/api/works',
    headers=headers,
    files=files,
    data=data
)
```

### C.  å‰ç«¯é›†æˆç¤ºä¾‹ï¼ˆJavaScriptï¼‰

```javascript
// 1. ç”¨æˆ·ç™»å½•
async function login(username, password) {
  const response = await fetch('http://localhost:5000/api/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ username, password })
  });

  const data = await response.json();
  if (data.code === 200) {
    localStorage.setItem('access_token', data.data.access_token);
    return data.data.user;
  }
}

// 2. AIåˆ†æå•å­—
async function analyzeCharacter(imageFile) {
  const formData = new FormData();
  formData.append('image', imageFile);

  const response = await fetch('http://localhost:5000/api/calligraphy/analyze', {
    method: 'POST',
    body: formData
  });

  const data = await response.json();
  return data.data;
}

// 3. ä¿å­˜è¯»å¸–
async function saveAnnotation(characterId, keypoints, overallTips) {
  const token = localStorage.getItem('access_token');

  const response = await fetch('http://localhost:5000/api/annotations', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      character_id: characterId,
      source: 'ai',
      keypoints: keypoints,
      overall_tips: overallTips,
      is_public: true
    })
  });

  const data = await response.json();
  return data.data;
}
```

---

## æ›´æ–°æ—¥å¿—

### v1.0 (2025-12-03)

- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ŒæˆåŸºç¡€è®¤è¯åŠŸèƒ½
- âœ… å®Œæˆç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… å®Œæˆä½œå“ç®¡ç†åŠŸèƒ½
- âœ… å®ŒæˆOCRè¯†åˆ«åŠŸèƒ½
- âœ… å®ŒæˆAIè¯»å¸–åŠŸèƒ½
- âœ… å®Œæˆç¤¾åŒºåŠŸèƒ½
- âœ… å®Œæˆé€šçŸ¥åŠŸèƒ½
- âœ… å®Œæˆæ‰“å¡åŠŸèƒ½
- âœ… å®Œæˆå®¡æ ¸åŠŸèƒ½

---

## è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**: https://github.com/iCalligraphy
- **æŠ€æœ¯æ”¯æŒ**: support@icalligraphy.com
- **é—®é¢˜åé¦ˆ**: https://github.com/iCalligraphy/issues

---

**æ–‡æ¡£ç»“æŸ**


